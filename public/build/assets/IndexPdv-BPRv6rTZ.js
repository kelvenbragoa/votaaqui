import{s as pe}from"./index-BtWQ993g.js";import{s as ve}from"./index-JbnCDy-B.js";import{s as fe}from"./index-D4q2omWw.js";import{s as he}from"./index-CnKwZFsY.js";import{s as ye}from"./index-BUdsdqYF.js";import{s as ge}from"./index-BUr4YMT_.js";import{s as be}from"./index-CqRizCYi.js";import{s as _e}from"./index-BrYXoc-D.js";import{x as xe,r as l,y as we,o as Ce,a as ke,c as v,b as t,d as s,w as i,F as H,f as De,l as f,t as r,h as d,z as B,s as O,R as Re,i as Me,n as Se,m as $e,q as Ie}from"./app-DS2baS_n.js";import{h as W}from"./moment-C5S46NFB.js";import{d as Ve}from"./debounce-BMmXVQ06.js";import"./index-C6Z0hblE.js";import"./index-B9mXU8BC.js";import"./index-Cc00NeUz.js";import"./index-CB4w3mkd.js";import"./index-Db20dqtZ.js";import"./index-C4xTnPqq.js";import"./index-QcDmmBo-.js";import"./index-BdUc-6tC.js";import"./index-BmR6pOwU.js";import"./index-CkDGj_Jl.js";import"./index-DvAwJBAH.js";import"./index-VXIkeAsb.js";import"./index-CqjTOAB9.js";import"./index-DhGk9Arv.js";import"./index-ZzhbnyzE.js";import"./index-DUNuG4hG.js";import"./index-CJe96r15.js";const Te={key:0,class:"flex flex-col md:flex-row gap-12 min-h-screen items-center justify-center"},Ue={class:"w-full"},qe={class:"flex flex-col gap-4 text-center"},Fe={key:1},Pe={class:"mb-2"},Ne={key:0},Be={key:1},Ee={class:"grid grid-cols-12 gap-8"},Le={class:"flex justify-between mb-4"},je={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},Ye={class:"flex justify-between mb-4"},Qe={class:"text-primary font-medium"},Ze={class:"flex justify-between mb-4"},Ae={class:"p-fluid"},He={class:"field"},Oe={class:"p-fluid"},We={class:"field"},ze={class:"p-fluid"},Ge=["onClick"],Je=["onClick"],Ke={class:"p-4"},Xe={class:"p-4"},ea={class:"mt-4 flex justify-end space-x-2"},aa=["src"],sa="142502",Ta={__name:"IndexPdv",setup(ta){let E;const D=Ie(),u=xe();l(null);const R=l(!0);l(!1),l(null);const T=l(""),U=l(null),M=l(1),q=l(15),z=l(0);l(!1);const b=l(null),_=l(!1),x=l(!1),S=l(!1),$=l(0),G=l(0),h=l(0),L=l([]),j=l(0),J=l(!1),I=l(!1),Y=l(null),F=l(null),Q=l([]),w=l(!1),P=l(null);function K(){const o=document.querySelector("iframe");o&&(o.contentWindow.focus(),o.contentWindow.print())}function X(){I.value=!1}const ee=[{label:"Venda Rápida",items:[{label:"Inicar Venda Rápida",icon:"pi pi-fw pi-shopping-cart",command:()=>{D.push("/admin/pdv/quicksell")}},{label:"Lista",icon:"pi pi-fw pi-list",command:()=>{S.value=!0}}]},{label:"Caixa",items:[{label:"Abertura de caixa",icon:"pi pi-fw pi-unlock",command:()=>{_.value=!0}},{label:"Fecho de caixa",icon:"pi pi-fw pi-lock",command:()=>{x.value=!0}},{label:"Relatório de caixa",icon:"pi pi-fw pi-check",command:()=>{D.push("/admin/cashregisters/dashboard")}}]}];function ae(){D&&D.back()}function se(o){console.log("hello"),axios.post(`/api/getquickreceipt/${o}`,{},{responseType:"blob"}).then(e=>{const p=new Blob([e.data],{type:"application/pdf"});P.value=URL.createObjectURL(p),I.value=!0,u.add({severity:"success",summary:"Successo",detail:"Consumo Impresso com sucesso!",life:3e3})}).catch(async e=>{var y,V;R.value=!1;let p="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const g=await e.response.data.text(),c=JSON.parse(g);p=c.message||c.error||p}catch(g){console.error("Erro ao processar o blob:",g)}else(V=(y=e.response)==null?void 0:y.data)!=null&&V.message&&(p=e.response.data.message);u.add({severity:"error",summary:"Erro",detail:p,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)})}const te=()=>{_.value=!1},oe=()=>{x.value=!1},le=()=>{S.value=!1},ie=o=>{Y.value=o,w.value=!0};function Z(o){switch(o){case 1:return"red";case 2:return"red";case 3:return"warn";case 4:return"danger";case 5:return"info";case 6:return"info"}}function re(o){switch(o){case 1:return"success";case 2:return"danger";case 3:return"warn";case 4:return"danger";case 5:return"info";case 6:return"info"}}const C=async(o=1)=>{axios.get(`/api/pdv?page=${o}`,{params:{query:T.value}}).then(e=>{U.value=e.data.tables,z.value=U.value.total,b.value=e.data.cash_register,h.value=e.data.totalcash,R.value=!1}).catch(e=>{R.value=!1,u.add({severity:"error",summary:`${e}`,detail:"Message Detail",life:3e3}),ae()})},N=async(o=1)=>{axios.get(`/api/pdvquicksellslist?page=${o}`,{params:{query:T.value}}).then(e=>{L.value=e.data.quicksells,j.value=e.data.quicksells.total}).catch(e=>{u.add({severity:"error",summary:`${e}`,detail:"Message Detail",life:3e3})})};function ne(){axios.post("/api/cashregisters/open",{opening_balance:$.value}).then(o=>{_.value=!1,$.value=null,b.value=o.data,u.add({severity:"success",summary:"Sucesso",detail:"Caixa aberto com sucesso!",life:3e3})}).catch(o=>{u.add({severity:"error",summary:"Erro",detail:`Falha ao abrir o caixa. ${o.response.data.message}`,life:3e3}),console.error(o)})}function de(){axios.post("/api/cashregisters/close",{closing_balance:h.value}).then(o=>{x.value=!1,G.value=null,b.value=null,h.value=0,u.add({severity:"success",summary:"Sucesso",detail:"Caixa Fechado com sucesso!",life:3e3})}).catch(o=>{u.add({severity:"error",summary:"Erro",detail:`Falha ao fechar o caixa. ${o.response.data.message}`,life:3e3}),console.error(o)})}const ce=()=>{if(F.value!==sa){u.add({severity:"error",summary:"Erro",detail:"Código de confirmação inválido",life:3e3});return}else axios.post(`/api/quickorderdelete/${Y.value}`).then(o=>{w.value=!1,C(),N(),u.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(o=>{u.add({severity:"error",summary:"Erro",detail:`${o}`,life:3e3})}).finally(()=>{})},ue=o=>{M.value=o.page+1,q.value=o.rows,C(M.value)},me=Ve(()=>{C(M.value)},300);return we(T,me),Ce(()=>{C(),N(),E=setInterval(()=>{C(),N()},3e4)}),ke(()=>{clearInterval(E)}),(o,e)=>{const p=_e,y=be,V=ge,g=ye,c=he,k=fe,n=ve,A=pe;return f(),v(H,null,[R.value?(f(),v("div",Te,[t("div",Ue,[t("div",qe,[s(p,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[10]||(e[10]=t("p",null,"Por Favor Aguarde...",-1))])])])):(f(),v("div",Fe,[t("div",Pe,[s(V,{model:ee},{end:i(()=>[t("span",null,"Total Venda Hoje: "+r(h.value)+" MT",1),e[11]||(e[11]=d(" | ")),b.value?(f(),v("span",Ne,[s(y,{value:"Caixa Iniciado ás: "+B(W)(b.value.created_at).format("DD-MM-YYYY H:mm"),severity:"success"},null,8,["value"])])):(f(),v("span",Be,[s(y,{value:"Caixa Não Iniciado",severity:"danger"})]))]),_:1})]),t("div",Ee,[(f(!0),v(H,null,De(U.value.data,(a,m)=>(f(),v("div",{class:"col-span-12 lg:col-span-6 xl:col-span-3",key:a.id},[s(B(Re),{to:"/admin/pdv/"+a.id+"/categories"},{default:i(()=>[t("div",{class:O(["card mb-0",{"bg-green-100":a.table_status_id===1,"bg-red-100":a.table_status_id===2}])},[t("div",Le,[t("div",null,[t("div",je,r(a.name),1)]),t("div",{class:O(["flex items-center justify-center rounded-full",`bg-${Z(a.status_id)}-100`,`dark:bg-${Z(a.status_id)}-400/10`]),style:{width:"2.5rem",height:"2.5rem"}},e[12]||(e[12]=[t("i",{class:"pi pi-list text-blue-500 !text-xl","aria-label":"Carrinho de Compras"},null,-1)]),2)]),t("div",Ye,[t("span",Qe,"Capacidade: "+r(a.capacity),1),t("span",null,[s(y,{value:a.status.name,severity:re(a.table_status_id)},null,8,["value","severity"])])]),t("div",Ze,[t("small",null,"Consumo: "+r(a.last_order!=null?a.last_order.total:0)+" MT",1),t("small",null,r(a.last_order!=null?a.last_order.user.name:""),1)])],2)]),_:2},1032,["to"])]))),128))])])),s(k,{header:"Abertura de Caixa",visible:_.value,"onUpdate:visible":e[1]||(e[1]=a=>_.value=a),style:{width:"400px"},modal:!0},{footer:i(()=>[s(c,{label:"Cancelar",icon:"pi pi-times",onClick:te,class:"p-button-text"}),s(c,{label:"Abrir Caixa",icon:"pi pi-check",onClick:ne,autofocus:""})]),default:i(()=>[t("div",Ae,[t("div",He,[e[13]||(e[13]=t("label",{for:"opening_balance"},"Saldo Inicial (MZN)",-1)),s(g,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value=a),inputId:"opening_balance",mode:"currency",currency:"MZN",locale:"pt-MZ",min:-1,placeholder:"0.00"},null,8,["modelValue"])])])]),_:1},8,["visible"]),s(k,{header:"Fechamento de Caixa",visible:x.value,"onUpdate:visible":e[3]||(e[3]=a=>x.value=a),style:{width:"400px"},modal:!0},{footer:i(()=>[s(c,{label:"Cancelar",icon:"pi pi-times",onClick:oe,class:"p-button-text"}),s(c,{label:"Fechar Caixa",icon:"pi pi-check",onClick:de,autofocus:""})]),default:i(()=>[t("div",Oe,[t("div",We,[e[14]||(e[14]=t("label",{for:"closing_balance"},"Saldo Final (MZN)",-1)),s(g,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=a=>h.value=a),inputId:"closing_balance",mode:"currency",currency:"MZN",locale:"pt-MZ",min:-1,placeholder:"0.00"},null,8,["modelValue"])])])]),_:1},8,["visible"]),s(k,{header:"Lista de Vendas Rápidas",visible:S.value,"onUpdate:visible":e[5]||(e[5]=a=>S.value=a),style:{width:"90vw",maxWidth:"940px"},modal:!0},{footer:i(()=>[s(c,{label:"Cancelar",icon:"pi pi-times",onClick:le,class:"p-button-text"})]),default:i(()=>[t("div",ze,[s(A,{expandedRows:Q.value,"onUpdate:expandedRows":e[4]||(e[4]=a=>Q.value=a),paginator:!0,rows:q.value,totalRecords:j.value,dataKey:"id",lazy:!0,rowHover:!0,loading:J.value,first:(M.value-1)*q.value,onPage:ue,showGridlines:"",value:L.value.data,tableStyle:"min-width: 60rem"},{expansion:i(a=>[t("div",Ke,[t("h5",null,"Orders for #"+r(a.data.id)+" ("+r(a.data.itens.length)+")",1),s(A,{value:a.data.itens},{default:i(()=>[s(n,{field:"id",header:"Id",sortable:""}),s(n,{header:"Produto",style:{"min-width":"12rem"}},{body:i(({data:m})=>[d(r(m.product.name),1)]),_:1}),s(n,{header:"Quantidade",style:{"min-width":"12rem"}},{body:i(({data:m})=>[d(r(m.quantity),1)]),_:1}),s(n,{header:"Preço",style:{"min-width":"12rem"}},{body:i(({data:m})=>[d(r(m.price)+" MT ",1)]),_:1}),s(n,{header:"Total",style:{"min-width":"12rem"}},{body:i(({data:m})=>[d(r(m.total)+" MT ",1)]),_:1})]),_:2},1032,["value"])])]),default:i(()=>[s(n,{expander:"",style:{width:"5rem"}}),s(n,{header:"Ações",style:{"min-width":"12rem"}},{body:i(({data:a})=>[t("i",{class:"pi pi-trash m-4",onClick:m=>ie(a.id)},null,8,Ge),t("i",{class:"pi pi-print m-4",onClick:m=>se(a.id)},null,8,Je)]),_:1}),s(n,{header:"ID",style:{"min-width":"12rem"}},{body:i(({data:a})=>[d(" #"+r(a.id),1)]),_:1}),s(n,{header:"Valor",style:{"min-width":"12rem"}},{body:i(({data:a})=>[d(r(a.total)+" MT ",1)]),_:1}),s(n,{header:"Pedido",style:{"min-width":"12rem"}},{body:i(({data:a})=>e[15]||(e[15]=[d(" Pedido Rápido ")])),_:1}),s(n,{header:"Garçom",style:{"min-width":"12rem"}},{body:i(({data:a})=>[d(r(a.user.name),1)]),_:1}),s(n,{header:"Estado",style:{"min-width":"12rem"}},{body:i(({data:a})=>[d(r(a.status.name),1)]),_:1}),s(n,{header:"Itens",style:{"min-width":"12rem"}},{body:i(({data:a})=>[d(r(a.itens.length),1)]),_:1}),s(n,{header:"Data",dataType:"date",style:{"min-width":"10rem"}},{body:i(({data:a})=>[d(r(B(W)(a.created_at).format("DD-MM-YYYY H:mm")),1)]),_:1})]),_:1},8,["expandedRows","rows","totalRecords","loading","first","value"])])]),_:1},8,["visible"]),s(k,{header:"Confirmar Exclusão",visible:w.value,"onUpdate:visible":e[8]||(e[8]=a=>w.value=a),style:{width:"20vw"}},{default:i(()=>[t("div",Xe,[e[16]||(e[16]=t("p",{class:"mb-4"},[d("Insira o código para confirmar a exclusão do item "),t("strong"),d(".")],-1)),Me(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>F.value=a),type:"password",placeholder:"Código de confirmação",class:"w-full p-2 border rounded"},null,512),[[Se,F.value]]),t("div",ea,[s(c,{label:"Cancelar",onClick:e[7]||(e[7]=a=>w.value=!1),class:"bg-gray-300 hover:bg-gray-400 text-black font-semibold px-4 py-2 rounded"}),s(c,{label:"Confirmar",onClick:ce,class:"bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),s(k,{visible:I.value,"onUpdate:visible":e[9]||(e[9]=a=>I.value=a),header:"Recibo",modal:!0,style:{width:"600px"},closable:!1},{footer:i(()=>[s(c,{label:"Imprimir",icon:"pi pi-print",onClick:K}),s(c,{label:"Fechar",icon:"pi pi-times",class:"p-button-text",onClick:X})]),default:i(()=>[P.value?(f(),v("iframe",{key:0,src:P.value,style:{width:"100%",height:"500px"},frameborder:"0"},null,8,aa)):$e("",!0)]),_:1},8,["visible"])],64)}}};export{Ta as default};
