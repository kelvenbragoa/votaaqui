import{s as de}from"./index-CDqNT4St.js";import{s as ce}from"./index-Ck0pw5nd.js";import{s as ue}from"./index-CnszjjtJ.js";import{s as me}from"./index-DzcF86oG.js";import{s as pe}from"./index-CTfp0x3z.js";import{s as ve}from"./index-BAOFFhWA.js";import{s as fe}from"./index-o3qi-ec1.js";import{u as ge,r as l,w as ye,o as he,aR as be,c as f,a as o,b as s,F as O,a5 as _e,e as i,f as g,n as W,t as r,g as Y,R as xe,d as c,i as we,L as Ce,aS as ke,k as De}from"./app-DrVY5UIB.js";import{d as Re,h as Se}from"./moment-CQ1ixRO1.js";import"./index-BnfWDIPH.js";import"./index--EEhPIfl.js";import"./index-BCrV5xA7.js";import"./index-LzfBnFcQ.js";import"./index-CZNYUL1o.js";import"./index-BO4gTK7C.js";import"./index-ChNyJrCk.js";import"./index-BYCe9Ecl.js";import"./index-BAE_mEon.js";import"./index-DuQbNip_.js";import"./index-QlbquBzF.js";import"./index-3epIZWS7.js";import"./index-BovvML42.js";import"./index-CpYWlWMi.js";import"./index-pZUdUnUT.js";import"./index-OUojj5W6.js";import"./index-DytjaMpk.js";const $e={key:0,class:"flex flex-col md:flex-row gap-12 min-h-screen items-center justify-center"},Me={class:"w-full"},Ie={class:"flex flex-col gap-4 text-center"},Ue={key:1},Pe={class:"grid grid-cols-12 gap-8"},Te={class:"flex justify-between mb-4"},Ve={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},Fe={class:"flex justify-between mb-4"},qe={class:"text-primary font-medium"},Be={class:"flex justify-between mb-4"},Ee={class:"p-fluid"},Le={class:"field"},Ne={class:"p-fluid"},je={class:"field"},Qe={class:"p-fluid"},Ze=["onClick"],Ae=["onClick"],Oe={class:"p-4"},We=["src"],Ye={class:"p-4"},ze={class:"mt-4 flex justify-end space-x-2"},Ge="142502",Ca={__name:"IndexPdv",setup(He){let q;const B=De(),u=ge();l(null);const _=l(!0);l(!1),l(null);const S=l(""),$=l(null),x=l(1),M=l(15),z=l(0);l(!1);const I=l(null),w=l(!1),C=l(!1),k=l(0),E=l(0),U=l(0),P=l(!1),L=l([]),N=l(0),j=l([]),D=l(!1),T=l(null),Q=l(null),y=l(!1),V=l(null);function G(){const t=document.querySelector("iframe");t&&(t.contentWindow.focus(),t.contentWindow.print())}function H(){D.value=!1}function J(){B&&B.back()}const K=()=>{w.value=!1},X=()=>{C.value=!1},ee=t=>{Q.value=t,y.value=!0},ae=()=>{P.value=!1};function Z(t){switch(t){case 1:return"red";case 2:return"red";case 3:return"warn";case 4:return"danger";case 5:return"info";case 6:return"info"}}function se(t){switch(t){case 1:return"success";case 2:return"danger";case 3:return"warn";case 4:return"danger";case 5:return"info";case 6:return"info"}}function te(t){axios.post(`/api/getquickreceipt/${t}`,{},{responseType:"blob"}).then(e=>{const p=new Blob([e.data],{type:"application/pdf"});T.value=URL.createObjectURL(p),D.value=!0,openPrintReceipt.value=!1,u.add({severity:"success",summary:"Successo",detail:"Consumo Impresso com sucesso!",life:3e3})}).catch(async e=>{var R,b;console.log(e),_.value=!1;let p="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const d=await e.response.data.text(),v=JSON.parse(d);p=v.message||v.error||p}catch(d){console.error("Erro ao processar o blob:",d)}else(b=(R=e.response)==null?void 0:R.data)!=null&&b.message&&(p=e.response.data.message);u.add({severity:"error",summary:"Erro",detail:p,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)})}const h=async(t=1)=>{axios.get(`/api/pdv?page=${t}`,{params:{query:S.value}}).then(e=>{$.value=e.data.tables,z.value=$.value.total,I.value=e.data.cash_register,U.value=e.data.totalcash,_.value=!1}).catch(e=>{_.value=!1,u.add({severity:"error",summary:`${e}`,detail:"Message Detail",life:3e3}),J()})};function oe(){axios.post("/api/cashregisters/open",{opening_balance:k.value}).then(t=>{w.value=!1,k.value=null,I.value=t.data,u.add({severity:"success",summary:"Sucesso",detail:"Caixa aberto com sucesso!",life:3e3})}).catch(t=>{u.add({severity:"error",summary:"Erro",detail:`Falha ao abrir o caixa. ${t.response.data.message}`,life:3e3}),console.error(t)})}const F=async(t=1)=>{axios.get(`/api/pdvquicksellslist?page=${t}`,{params:{query:S.value}}).then(e=>{L.value=e.data.quicksells,N.value=e.data.quicksells.total}).catch(e=>{u.add({severity:"error",summary:`${e}`,detail:"Message Detail",life:3e3})})};function le(){axios.post("/api/cashregisters/close",{closing_balance:E.value}).then(t=>{C.value=!1,E.value=null,I.value=null,u.add({severity:"success",summary:"Sucesso",detail:"Caixa Fechado com sucesso!",life:3e3})}).catch(t=>{u.add({severity:"error",summary:"Erro",detail:`Falha ao fechar o caixa. ${t.response.data.message}`,life:3e3}),console.error(t)})}const ie=()=>{if(V.value!==Ge){u.add({severity:"error",summary:"Erro",detail:"Código de confirmação inválido",life:3e3});return}else axios.post(`/api/quickorderdelete/${Q.value}`).then(t=>{y.value=!1,h(),F(),u.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(t=>{u.add({severity:"error",summary:"Erro",detail:`${t}`,life:3e3})}).finally(()=>{})},re=t=>{x.value=t.page+1,M.value=t.rows,h(x.value)},ne=Re(()=>{h(x.value)},300);return ye(S,ne),he(()=>{h(),F(),q=setInterval(()=>{h()},3e4),F()}),be(()=>{clearInterval(q)}),(t,e)=>{const p=fe,R=ve,b=pe,d=me,v=ue,n=ce,A=de;return g(),f(O,null,[_.value?(g(),f("div",$e,[o("div",Me,[o("div",Ie,[s(p,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[10]||(e[10]=o("p",null,"Por Favor Aguarde...",-1))])])])):(g(),f("div",Ue,[o("div",Pe,[(g(!0),f(O,null,_e($.value.data,(a,m)=>(g(),f("div",{class:"col-span-12 lg:col-span-6 xl:col-span-3",key:a.id},[s(Y(xe),{to:"/tablemanager/pdv/"+a.id+"/categories"},{default:i(()=>[o("div",{class:W(["card mb-0",{"bg-green-100":a.table_status_id===1,"bg-red-100":a.table_status_id===2}])},[o("div",Te,[o("div",null,[o("div",Ve,r(a.name),1)]),o("div",{class:W(["flex items-center justify-center rounded-full",`bg-${Z(a.status_id)}-100`,`dark:bg-${Z(a.status_id)}-400/10`]),style:{width:"2.5rem",height:"2.5rem"}},e[11]||(e[11]=[o("i",{class:"pi pi-list text-blue-500 !text-xl","aria-label":"Carrinho de Compras"},null,-1)]),2)]),o("div",Fe,[o("span",qe,"Capacidade: "+r(a.capacity),1),o("span",null,[s(R,{value:a.status.name,severity:se(a.table_status_id)},null,8,["value","severity"])])]),o("div",Be,[o("small",null,"Consumo: "+r(a.last_order!=null?a.last_order.total:0)+" MT",1),o("small",null,r(a.last_order!=null?a.last_order.user.name:""),1)])],2)]),_:2},1032,["to"])]))),128))])])),s(v,{header:"Abertura de Caixa",visible:w.value,"onUpdate:visible":e[1]||(e[1]=a=>w.value=a),style:{width:"400px"},modal:!0},{footer:i(()=>[s(d,{label:"Cancelar",icon:"pi pi-times",onClick:K,class:"p-button-text"}),s(d,{label:"Abrir Caixa",icon:"pi pi-check",onClick:oe,autofocus:""})]),default:i(()=>[o("div",Ee,[o("div",Le,[e[12]||(e[12]=o("label",{for:"opening_balance"},"Saldo Inicial (MZN)",-1)),s(b,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),inputId:"opening_balance",mode:"currency",currency:"MZN",locale:"pt-MZ",min:-1,placeholder:"0.00"},null,8,["modelValue"])])])]),_:1},8,["visible"]),s(v,{header:"Fechamento de Caixa",visible:C.value,"onUpdate:visible":e[3]||(e[3]=a=>C.value=a),style:{width:"400px"},modal:!0},{footer:i(()=>[s(d,{label:"Cancelar",icon:"pi pi-times",onClick:X,class:"p-button-text"}),s(d,{label:"Fechar Caixa",icon:"pi pi-check",onClick:le,autofocus:""})]),default:i(()=>[o("div",Ne,[o("div",je,[e[13]||(e[13]=o("label",{for:"closing_balance"},"Saldo Final (MZN)",-1)),s(b,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=a=>U.value=a),inputId:"closing_balance",mode:"currency",currency:"MZN",locale:"pt-MZ",min:-1,placeholder:"0.00"},null,8,["modelValue"])])])]),_:1},8,["visible"]),s(v,{header:"Lista de Vendas Rápidas",visible:P.value,"onUpdate:visible":e[5]||(e[5]=a=>P.value=a),style:{width:"90vw",maxWidth:"940px"},modal:!0},{footer:i(()=>[s(d,{label:"Cancelar",icon:"pi pi-times",onClick:ae,class:"p-button-text"})]),default:i(()=>[o("div",Qe,[s(A,{expandedRows:j.value,"onUpdate:expandedRows":e[4]||(e[4]=a=>j.value=a),paginator:!0,rows:M.value,totalRecords:N.value,dataKey:"id",lazy:!0,rowHover:!0,loading:t.isLoadingQuickSell,first:(x.value-1)*M.value,onPage:re,showGridlines:"",value:L.value.data,tableStyle:"min-width: 60rem"},{expansion:i(a=>[o("div",Oe,[o("h5",null,"Orders for #"+r(a.data.id)+" ("+r(a.data.itens.length)+")",1),s(A,{value:a.data.itens},{default:i(()=>[s(n,{field:"id",header:"Id",sortable:""}),s(n,{header:"Produto",style:{"min-width":"12rem"}},{body:i(({data:m})=>[c(r(m.product.name),1)]),_:1}),s(n,{header:"Quantidade",style:{"min-width":"12rem"}},{body:i(({data:m})=>[c(r(m.quantity),1)]),_:1}),s(n,{header:"Preço",style:{"min-width":"12rem"}},{body:i(({data:m})=>[c(r(m.price)+" MT ",1)]),_:1}),s(n,{header:"Total",style:{"min-width":"12rem"}},{body:i(({data:m})=>[c(r(m.total)+" MT ",1)]),_:1})]),_:2},1032,["value"])])]),default:i(()=>[s(n,{expander:"",style:{width:"5rem"}}),s(n,{header:"Ações",style:{"min-width":"12rem"}},{body:i(({data:a})=>[o("i",{class:"pi pi-trash m-4",onClick:m=>ee(a.id)},null,8,Ze),o("i",{class:"pi pi-print m-4",onClick:m=>te(a.id)},null,8,Ae)]),_:1}),s(n,{header:"ID",style:{"min-width":"12rem"}},{body:i(({data:a})=>[c(" #"+r(a.id),1)]),_:1}),s(n,{header:"Valor",style:{"min-width":"12rem"}},{body:i(({data:a})=>[c(r(a.total)+" MT ",1)]),_:1}),s(n,{header:"Pedido",style:{"min-width":"12rem"}},{body:i(({data:a})=>e[14]||(e[14]=[c(" Pedido Rápido ")])),_:1}),s(n,{header:"Garçom",style:{"min-width":"12rem"}},{body:i(({data:a})=>[c(r(a.user.name),1)]),_:1}),s(n,{header:"Estado",style:{"min-width":"12rem"}},{body:i(({data:a})=>[c(r(a.status.name),1)]),_:1}),s(n,{header:"Itens",style:{"min-width":"12rem"}},{body:i(({data:a})=>[c(r(a.itens.length),1)]),_:1}),s(n,{header:"Data",dataType:"date",style:{"min-width":"10rem"}},{body:i(({data:a})=>[c(r(Y(Se)(a.created_at).format("DD-MM-YYYY H:mm")),1)]),_:1})]),_:1},8,["expandedRows","rows","totalRecords","loading","first","value"])])]),_:1},8,["visible"]),s(v,{visible:D.value,"onUpdate:visible":e[6]||(e[6]=a=>D.value=a),header:"Recibo",modal:!0,style:{width:"600px"},closable:!1},{footer:i(()=>[s(d,{label:"Imprimir",icon:"pi pi-print",onClick:G}),s(d,{label:"Fechar",icon:"pi pi-times",class:"p-button-text",onClick:H})]),default:i(()=>[T.value?(g(),f("iframe",{key:0,src:T.value,style:{width:"100%",height:"500px"},frameborder:"0"},null,8,We)):we("",!0)]),_:1},8,["visible"]),s(v,{header:"Confirmar Exclusão",visible:y.value,"onUpdate:visible":e[9]||(e[9]=a=>y.value=a),style:{width:"20vw"}},{default:i(()=>[o("div",Ye,[e[15]||(e[15]=o("p",{class:"mb-4"},[c("Insira o código para confirmar a exclusão do item "),o("strong"),c(".")],-1)),Ce(o("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>V.value=a),type:"password",placeholder:"Código de confirmação",class:"w-full p-2 border rounded"},null,512),[[ke,V.value]]),o("div",ze,[s(d,{label:"Cancelar",onClick:e[8]||(e[8]=a=>y.value=!1),class:"bg-gray-300 hover:bg-gray-400 text-black font-semibold px-4 py-2 rounded"}),s(d,{label:"Confirmar",onClick:ie,class:"bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"])],64)}}};export{Ca as default};
