import{s as fe}from"./index-LzfBnFcQ.js";import{s as be}from"./index-CnszjjtJ.js";import{s as ye}from"./index-DzcF86oG.js";import{s as ge,a as _e,b as xe}from"./index-BTnVhyax.js";import{s as he,a as we}from"./index-ChtszOvl.js";import{s as ke}from"./index-BLDjMPDf.js";import{s as Ce}from"./index-o3qi-ec1.js";import{u as Te,r as l,w as De,o as $e,c as r,a as s,b as o,d as C,t as i,i as N,F as y,a5 as g,e as u,f as n,j as L,L as je,aS as Me,k as Se}from"./app-DrVY5UIB.js";import{d as Ue}from"./moment-CQ1ixRO1.js";import"./index-BnfWDIPH.js";import"./index-CZNYUL1o.js";import"./index--EEhPIfl.js";import"./index-BO4gTK7C.js";import"./index-ChNyJrCk.js";import"./index-BYCe9Ecl.js";import"./index-OUojj5W6.js";import"./index-DHvi7lrb.js";import"./index-DuQbNip_.js";import"./index-QlbquBzF.js";import"./index-DytjaMpk.js";import"./index-BAE_mEon.js";const Re={key:0,class:"flex flex-col md:flex-row gap-12 min-h-screen items-center justify-center"},Ee={class:"w-full"},Pe={class:"flex flex-col gap-4 text-center"},Be={key:1},Ne={class:"grid grid-cols-12 gap-4 h-screen"},Le={class:"col-span-12 lg:col-span-3 h-full"},Fe={class:"card flex flex-col gap-4 h-full"},Oe={key:0},qe=["onClick"],Ve={class:"flex justify-between mb-4"},Ie={key:0,class:"mt-4"},Ze={key:0,class:"flex flex-col gap-4 text-center"},Ae={class:"col-span-12 lg:col-span-9"},We={class:"mb-2"},Je={class:"card flex flex-col gap-4"},ze={key:0},He={class:"grid grid-cols-12 gap-8"},Qe={class:"card mb-0 bg-gray-100"},Xe={class:"mb-4"},Ge=["src"],Ke={class:"flex justify-between mb-2"},Ye={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},es={class:"flex justify-between mb-2"},ss={class:"text-primary font-medium"},ts={class:"flex justify-between mb-2"},as={key:1},ls={class:"p-4"},os={class:"space-y-2"},ns={class:"mt-4 text-lg font-semibold"},is={class:"text-blue-500"},rs={class:"mt-4 flex justify-end"},us={class:"p-4"},ds={class:"mt-4 flex justify-end space-x-2"},cs={class:"p-4"},ps={class:"space-y-2"},ms={class:"mt-4 text-lg font-semibold"},vs={class:"text-blue-500"},fs={class:"mt-4 flex justify-end"},bs={class:"p-4"},ys={class:"space-y-2"},gs={class:"mt-4 text-lg font-semibold"},_s={class:"text-blue-500"},xs={class:"mt-4 flex justify-end"},hs=["src"],ws="142502",Ws={__name:"IndexPdvCategories",setup(ks){const x=Se(),p=Te();l(null);const U=l(!0),F=l(!1);let J=l(null);const z=l(""),R=l(null),ee=l(1);l(15),l(0);const O=l(!1),E=l(null),q=l([]),$=l(0),T=l(0),_=l(!1),j=l([]);l(!1);const M=l(1),V=l([]),se=l(null),I=l(null),D=l(!1),h=l(null),Z=l(null),A=l(!1),P=l(!1),H=l(!1),W=l(!1),Q=l(!1),B=l(!1),te=[{label:"Consumo",items:[{label:"Ver consumo",icon:"pi pi-fw pi-folder-open",command:()=>{P.value=!0}},{label:"Imprimir Consumo",icon:"pi pi-fw pi-print",command:()=>{de()}}]}];function ae(){x&&x.back()}const le=()=>{if(I.value!==ws){p.add({severity:"error",summary:"Erro",detail:"Código de confirmação inválido",life:3e3});return}else axios.post(`/api/orderitem/${se.value}`).then(a=>{R.value=a.data,T.value=a.data.total_consumed,E.value=a.data.categories,j.value=a.data.order_items,V.value=a.data.payment_methods,M.value=1,B.value=!1,p.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{p.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3})}).finally(()=>{})},X=()=>{O.value=!1};function oe(){_.value=!0,axios.get(`/api/pdv/closeaccount/${x.currentRoute.value.params.id}`,{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});h.value=URL.createObjectURL(e),D.value=!0,W.value=!1,p.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async a=>{var d,f;_.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const c=await a.response.data.text(),m=JSON.parse(c);e=m.message||m.error||e}catch(c){console.error("Erro ao processar o blob:",c)}else(f=(d=a.response)==null?void 0:d.data)!=null&&f.message&&(e=a.response.data.message);p.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)}).finally(()=>{_.value=!1})}function ne(){const a={payment_method_id:M.value,table_id:x.currentRoute.value.params.id};_.value=!0,axios.post("/api/payaccount",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{h.value&&URL.revokeObjectURL(h.value);const d=new Blob([e.data],{type:"application/pdf"});h.value=URL.createObjectURL(d),D.value=!0,H.value=!1,p.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async e=>{var f,c;console.log(e),_.value=!1;let d="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const m=await e.response.data.text(),S=JSON.parse(m);d=S.message||S.error||d}catch(m){console.error("Erro ao processar o blob:",m)}else(c=(f=e.response)==null?void 0:f.data)!=null&&c.message&&(d=e.response.data.message);p.add({severity:"error",summary:"Erro",detail:d,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{_.value=!1})}function ie(a){q.value.splice(a,1),re()}function re(){$.value=q.value.reduce((a,e)=>a+e.price*e.quantity,0)}function ue(){const a=document.querySelector("iframe");a&&(a.contentWindow.focus(),a.contentWindow.print())}function de(){axios.post(`/api/getreceipt/${x.currentRoute.value.params.id}`,{},{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});h.value=URL.createObjectURL(e),D.value=!0,H.value=!1,p.add({severity:"success",summary:"Successo",detail:"Consumo Impresso com sucesso!",life:3e3})}).catch(async a=>{var d,f;U.value=!1,console.log(a),_.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const c=await a.response.data.text(),m=JSON.parse(c);e=m.message||m.error||e}catch(c){console.error("Erro ao processar o blob:",c)}else(f=(d=a.response)==null?void 0:d.data)!=null&&f.message&&(e=a.response.data.message);p.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)})}const G=async(a=1)=>{axios.get(`/api/pdv/${x.currentRoute.value.params.id}`,{params:{query:z.value}}).then(e=>{R.value=e.data,Z.value=e.data.table,T.value=e.data.total_consumed,E.value=e.data.categories,j.value=e.data.order_items,V.value=e.data.payment_methods,M.value=1,U.value=!1}).catch(e=>{ae(),U.value=!1,p.add({severity:"error",summary:"Erro",detail:`${e.response.data.message}`,life:3e3})})},ce=()=>{F.value=!0,axios.delete(`/api/tables/${J.value}`).then(()=>{R.value.data=R.value.data.filter(a=>a.id!==J.value),X(),p.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{p.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3}),F.value=!1}).finally(()=>{F.value=!1})};function pe(){D.value=!0,x.back()}const me=Ue(()=>{G(ee.value)},300);return De(z,me),$e(()=>{G()}),(a,e)=>{const d=Ce,f=ke,c=_e,m=xe,S=he,K=we,Y=ge,b=ye,w=be,ve=fe;return n(),r(y,null,[U.value?(n(),r("div",Re,[s("div",Ee,[s("div",Pe,[o(d,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[14]||(e[14]=s("p",null,"Por Favor Aguarde...",-1))])])])):(n(),r("div",Be,[s("div",Ne,[s("div",Le,[s("div",Fe,[s("h2",null,[e[15]||(e[15]=C("Resumo da venda ")),$.value>0?(n(),r("div",Oe,[s("strong",null,"Total: "+i($.value)+" MT",1)])):N("",!0)]),(n(!0),r(y,null,g(q.value,(t,v)=>(n(),r("div",{key:v,class:"card bg-gray-100 p-4"},[s("div",null,[s("strong",null,i(t.name),1),s("button",{onClick:k=>ie(v),class:"rounded-full bg-red-100",style:{width:"2.5rem",height:"2.5rem"}},"X",8,qe)]),s("div",Ve,[s("div",null,i(t.quantity)+" x "+i(t.price)+" MT",1),s("div",null,i(t.price*t.quantity)+" MT",1)])]))),128)),$.value>0?(n(),r("div",Ie,[s("strong",null,"Total: "+i($.value)+" MT",1),_.value?(n(),r("div",Ze,[o(d,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):N("",!0)])):N("",!0)])]),s("div",Ae,[s("div",We,[o(f,{model:te},{end:u(()=>[s("p",null,[e[16]||(e[16]=s("strong",null,"Mesa:",-1)),C(" "+i(Z.value==null?"":Z.value.name)+" | ",1),e[17]||(e[17]=s("strong",null,"Total Consumo:",-1)),C(" "+i(T.value)+" MT",1)])]),_:1})]),s("div",Je,[o(Y,{value:1},{default:u(()=>[o(m,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:u(()=>[(n(!0),r(y,null,g(E.value,t=>(n(),L(c,{key:t.id,value:t.id},{default:u(()=>[C(i(t.name),1)]),_:2},1032,["value"]))),128))]),_:1}),o(K,null,{default:u(()=>[(n(!0),r(y,null,g(E.value,t=>(n(),L(S,{key:t.id,value:t.id},{default:u(()=>[o(Y,{value:0},{default:u(()=>[o(m,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:u(()=>[(n(!0),r(y,null,g(t.sub_categories,v=>(n(),L(c,{key:v.id,value:v.id},{default:u(()=>[C(i(v.name),1)]),_:2},1032,["value"]))),128))]),_:2},1024),o(K,null,{default:u(()=>[(n(!0),r(y,null,g(t.sub_categories,v=>(n(),L(S,{key:v.id,value:v.id},{default:u(()=>[v.products.length>0?(n(),r("div",ze,[s("div",He,[(n(!0),r(y,null,g(v.products,k=>(n(),r("div",{key:k.id,class:"col-span-12 lg:col-span-6 xl:col-span-3"},[s("div",Qe,[s("div",Xe,[s("img",{src:k.image?`/${k.image}`:"/image/image.png",alt:"Imagem do Produto",class:"w-full h-32 rounded-t-lg"},null,8,Ge)]),s("div",Ke,[s("div",Ye,i(k.name),1)]),s("div",es,[s("span",ss,"Preço: "+i(k.price)+" MT",1)]),s("div",ts,[s("small",null,"Stock:"+i(k.quantity_in_principal_stock),1)])])]))),128))])])):(n(),r("div",as,e[18]||(e[18]=[s("p",null,"No products available.",-1)])))]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})])])])])),o(w,{header:"Confirmação",visible:O.value,"onUpdate:visible":e[0]||(e[0]=t=>O.value=t),style:{width:"350px"},modal:!0},{footer:u(()=>[o(b,{label:"Não",icon:"pi pi-times",onClick:X,class:"p-button-text"}),o(b,{label:"Sim",icon:"pi pi-check",onClick:ce,class:"p-button-text",autofocus:""})]),default:u(()=>[e[19]||(e[19]=s("div",{class:"flex align-items-center justify-content-center"},[s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),s("span",null,"Tem certeza que deseja proceder?")],-1))]),_:1},8,["visible"]),o(w,{header:"Open File",visible:A.value,"onUpdate:visible":e[2]||(e[2]=t=>A.value=t),style:{width:"30vw"}},{default:u(()=>[e[20]||(e[20]=s("p",null,"Here you can manage your files or perform specific actions.",-1)),o(b,{label:"Close",onClick:e[1]||(e[1]=t=>A.value=!1)})]),_:1},8,["visible"]),o(w,{header:"Consumo da Mesa",visible:P.value,"onUpdate:visible":e[4]||(e[4]=t=>P.value=t),style:{width:"30vw"}},{default:u(()=>[s("div",ls,[e[22]||(e[22]=s("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),s("ul",os,[(n(!0),r(y,null,g(j.value,t=>(n(),r("li",{key:t.id,class:"flex justify-between border-b pb-2 mt-5"},[s("span",null,i(t.quantity)+" x "+i(t.product.name),1),s("span",null,"MZN "+i(t.total),1)]))),128))]),s("p",ns,[e[21]||(e[21]=s("span",null,"Total: ",-1)),s("span",is,"MZN "+i(T.value),1)]),s("div",rs,[o(b,{label:"Fechar",onClick:e[3]||(e[3]=t=>P.value=!1),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(w,{header:"Confirmar Exclusão",visible:B.value,"onUpdate:visible":e[7]||(e[7]=t=>B.value=t),style:{width:"20vw"}},{default:u(()=>[s("div",us,[e[23]||(e[23]=s("p",{class:"mb-4"},[C("Insira o código para confirmar a exclusão do item "),s("strong"),C(".")],-1)),je(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>I.value=t),type:"password",placeholder:"Código de confirmação",class:"w-full p-2 border rounded"},null,512),[[Me,I.value]]),s("div",ds,[o(b,{label:"Cancelar",onClick:e[6]||(e[6]=t=>B.value=!1),class:"bg-gray-300 hover:bg-gray-400 text-black font-semibold px-4 py-2 rounded"}),o(b,{label:"Confirmar",onClick:le,class:"bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(w,{header:"Fechar a conta",visible:W.value,"onUpdate:visible":e[9]||(e[9]=t=>W.value=t),style:{width:"30vw"}},{default:u(()=>[s("div",cs,[e[25]||(e[25]=s("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),s("ul",ps,[(n(!0),r(y,null,g(j.value,t=>(n(),r("li",{key:t.id,class:"flex justify-between border-b pb-2 mt-5"},[s("span",null,i(t.quantity)+" x "+i(t.product.name),1),s("span",null,"MZN "+i(t.total),1)]))),128))]),s("p",ms,[e[24]||(e[24]=s("span",null,"Total: ",-1)),s("span",vs,"MZN "+i(T.value),1)]),s("div",fs,[o(b,{label:"Fechar Conta",onClick:e[8]||(e[8]=t=>oe()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(w,{header:"Fechar a conta",visible:Q.value,"onUpdate:visible":e[12]||(e[12]=t=>Q.value=t),style:{width:"30vw"}},{default:u(()=>[s("div",bs,[e[27]||(e[27]=s("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),s("ul",ys,[(n(!0),r(y,null,g(j.value,t=>(n(),r("li",{key:t.id,class:"flex justify-between border-b pb-2 mt-5"},[s("span",null,i(t.quantity)+" x "+i(t.product.name),1),s("span",null,"MZN "+i(t.total),1)]))),128))]),o(ve,{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=t=>M.value=t),options:V.value,optionLabel:"name",optionValue:"id",class:"mt-2",placeholder:"Selecionar"},null,8,["modelValue","options"]),s("p",gs,[e[26]||(e[26]=s("span",null,"Total: ",-1)),s("span",_s,"MZN "+i(T.value),1)]),s("div",xs,[o(b,{label:"Pagar a Conta",onClick:e[11]||(e[11]=t=>ne()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(w,{visible:D.value,"onUpdate:visible":e[13]||(e[13]=t=>D.value=t),header:"Recibo",modal:!0,style:{width:"600px"},closable:!1},{footer:u(()=>[o(b,{label:"Imprimir",icon:"pi pi-print",onClick:ue}),o(b,{label:"Fechar",icon:"pi pi-times",class:"p-button-text",onClick:pe})]),default:u(()=>[h.value?(n(),r("iframe",{key:0,src:h.value,style:{width:"100%",height:"500px"},frameborder:"0"},null,8,hs)):N("",!0)]),_:1},8,["visible"])],64)}}};export{Ws as default};
