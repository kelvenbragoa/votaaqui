import{s as _e}from"./index-CnI_ApUM.js";import{s as xe}from"./index-C20BTk_p.js";import{s as he}from"./index-Dejt_gIu.js";import{s as we,a as ke,b as Ce}from"./index-AEPMI8G0.js";import{s as Te,a as De}from"./index-CXJR_zAh.js";import{s as $e}from"./index-i-xNvMx3.js";import{s as Se}from"./index-kyG4T3ah.js";import{x as je,r as l,y as Me,o as Re,c as u,b as t,d as o,h as _,t as r,m as L,F as g,f as x,w as d,l as n,B as F,i as Ue,n as Ee,q as Pe}from"./app-D6_Fxaix.js";import{d as qe}from"./moment-CQ1ixRO1.js";import"./index-BtSV8YwQ.js";import"./index-CO4mpAQ2.js";import"./index-BXcmxBR2.js";import"./index-Dp4FhzKV.js";import"./index-Dk1EIfqD.js";import"./index-DvB8Dxrf.js";import"./index-DkCkZuNI.js";import"./index-Cb8qytoa.js";import"./index-CxKNtRe5.js";import"./index-BlF2KGOo.js";import"./index-BzRfEpXS.js";import"./index-DuoSkiyB.js";const Be={key:0,class:"flex flex-col md:flex-row gap-12 min-h-screen items-center justify-center"},Ne={class:"w-full"},Le={class:"flex flex-col gap-4 text-center"},Fe={key:1},Oe={class:"grid grid-cols-12 gap-4 h-screen"},Ie={class:"col-span-12 lg:col-span-3 h-full"},Ve={class:"card flex flex-col gap-4 h-full"},Ae={key:0},Ze=["onClick"],Je={class:"flex justify-between mb-4"},We={key:0,class:"mt-4"},ze=["disabled"],He={key:0,class:"flex flex-col gap-4 text-center"},Qe={class:"col-span-12 lg:col-span-9"},Xe={class:"mb-2"},Ge={class:"card flex flex-col gap-4"},Ke={key:0},Ye={class:"grid grid-cols-12 gap-8"},et={class:"card mb-0 bg-gray-100"},tt={class:"mb-4"},st=["src"],at={class:"flex justify-between mb-2"},lt={class:"text-surface-900 dark:text-surface-0 font-medium text-xl"},ot={class:"flex justify-between mb-2"},nt={class:"text-primary font-medium"},it={class:"flex justify-between mb-2"},rt=["onClick"],ut={key:1},dt={class:"p-4"},ct={class:"space-y-2"},pt=["onClick"],mt={class:"mt-4 text-lg font-semibold"},vt={class:"text-blue-500"},ft={class:"mt-4 flex justify-end"},bt={class:"p-4"},yt={class:"mt-4 flex justify-end space-x-2"},gt={class:"p-4"},_t={class:"space-y-2"},xt={class:"mt-4 text-lg font-semibold"},ht={class:"text-blue-500"},wt={class:"mt-4 flex justify-end"},kt={class:"p-4"},Ct={class:"space-y-2"},Tt={class:"mt-4 text-lg font-semibold"},Dt={class:"text-blue-500"},$t={class:"mt-4 flex justify-end"},St=["src"],jt="142502",Yt={__name:"IndexPdvCategories",setup(Mt){const h=Pe(),m=je();l(null);const E=l(!0),O=l(!1);let H=l(null);const Q=l(""),P=l(null),se=l(1);l(15),l(0);const I=l(!1),q=l(null),$=l([]),S=l(0),j=l(0),f=l(!1),M=l([]),ae=l(!1),R=l(1),V=l([]),X=l(null),A=l(null),T=l(!1),w=l(null),Z=l(null),J=l(!1),B=l(!1),W=l(!1),N=l(!1),z=l(!1),U=l(!1),le=[{label:"Consumo",items:[{label:"Ver consumo",icon:"pi pi-fw pi-folder-open",command:()=>{B.value=!0}},{label:"Imprimir Consumo",icon:"pi pi-fw pi-print",command:()=>{ve()}}]},{label:"Conta",items:[{label:"Fechamento da Conta",icon:"pi pi-fw pi-lock",command:()=>{N.value=!0}},{label:"Finalizar da Conta",icon:"pi pi-fw pi-check",command:()=>{z.value=!0}}]}];function oe(){h&&h.back()}const ne=a=>{X.value=a,U.value=!0},ie=()=>{if(A.value!==jt){m.add({severity:"error",summary:"Erro",detail:"Código de confirmação inválido",life:3e3});return}else axios.post(`/api/orderitem/${X.value}`).then(a=>{P.value=a.data,j.value=a.data.total_consumed,q.value=a.data.categories,M.value=a.data.order_items,V.value=a.data.payment_methods,R.value=1,U.value=!1,m.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{m.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3})}).finally(()=>{})},G=()=>{I.value=!1};function re(){const a={products:$.value.map(e=>({id:e.id,name:e.name,quantity:e.quantity,total:e.price*e.quantity})),total:S.value,table_id:h.currentRoute.value.params.id};f.value=!0,axios.post("/api/pdv",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{ae.value=!1;const i=new Blob([e.data],{type:"application/pdf"});w.value=URL.createObjectURL(i),T.value=!0,W.value=!1,m.add({severity:"success",summary:"Successo",detail:"Produto encomedado sucesso!",life:3e3})}).catch(async e=>{var v,c;f.value=!1;let i="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const p=await e.response.data.text(),k=JSON.parse(p);i=k.message||k.error||i}catch(p){console.error("Erro ao processar o blob:",p)}else(c=(v=e.response)==null?void 0:v.data)!=null&&c.message&&(i=e.response.data.message);m.add({severity:"error",summary:"Erro",detail:i,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{f.value=!1})}function ue(){f.value=!0,axios.get(`/api/pdv/closeaccount/${h.currentRoute.value.params.id}`,{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});w.value=URL.createObjectURL(e),T.value=!0,N.value=!1,m.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async a=>{var i,v;f.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const c=await a.response.data.text(),p=JSON.parse(c);e=p.message||p.error||e}catch(c){console.error("Erro ao processar o blob:",c)}else(v=(i=a.response)==null?void 0:i.data)!=null&&v.message&&(e=a.response.data.message);m.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)}).finally(()=>{f.value=!1})}function de(){const a={payment_method_id:R.value,table_id:h.currentRoute.value.params.id};f.value=!0,axios.post("/api/payaccount",a,{headers:{"Content-Type":"multipart/form-data"},responseType:"blob"}).then(e=>{w.value&&URL.revokeObjectURL(w.value);const i=new Blob([e.data],{type:"application/pdf"});w.value=URL.createObjectURL(i),T.value=!0,W.value=!1,m.add({severity:"success",summary:"Successo",detail:"Encomenda fechada sucesso!",life:3e3})}).catch(async e=>{var v,c;console.log(e),f.value=!1;let i="Ocorreu um erro inesperado.";if(e.response&&e.response.data instanceof Blob)try{const p=await e.response.data.text(),k=JSON.parse(p);i=k.message||k.error||i}catch(p){console.error("Erro ao processar o blob:",p)}else(c=(v=e.response)==null?void 0:v.data)!=null&&c.message&&(i=e.response.data.message);m.add({severity:"error",summary:"Erro",detail:i,life:3e3}),e.response.data.errors&&setErrors(e.response.data.errors)}).finally(()=>{f.value=!1})}function ce(a){const e=$.value.find(v=>v.id===a.id),i=a.quantity_in_principal_stock??0;e?e.quantity<i&&(e.quantity+=1):i>0?$.value.push({...a,quantity:1}):m.add({severity:"error",summary:"Stock Insuficiente",detail:"Produto sem estoque disponível.",life:3e3}),K()}function pe(a){$.value.splice(a,1),K()}function K(){S.value=$.value.reduce((a,e)=>a+e.price*e.quantity,0)}function me(){const a=document.querySelector("iframe");a&&(a.contentWindow.focus(),a.contentWindow.print())}function ve(){axios.post(`/api/getreceipt/${h.currentRoute.value.params.id}`,{},{responseType:"blob"}).then(a=>{const e=new Blob([a.data],{type:"application/pdf"});w.value=URL.createObjectURL(e),T.value=!0,W.value=!1,m.add({severity:"success",summary:"Successo",detail:"Consumo Impresso com sucesso!",life:3e3})}).catch(async a=>{var i,v;E.value=!1,console.log(a),f.value=!1;let e="Ocorreu um erro inesperado.";if(a.response&&a.response.data instanceof Blob)try{const c=await a.response.data.text(),p=JSON.parse(c);e=p.message||p.error||e}catch(c){console.error("Erro ao processar o blob:",c)}else(v=(i=a.response)==null?void 0:i.data)!=null&&v.message&&(e=a.response.data.message);m.add({severity:"error",summary:"Erro",detail:e,life:3e3}),a.response.data.errors&&setErrors(a.response.data.errors)})}const Y=async(a=1)=>{axios.get(`/api/pdv/${h.currentRoute.value.params.id}`,{params:{query:Q.value}}).then(e=>{P.value=e.data,Z.value=e.data.table,j.value=e.data.total_consumed,q.value=e.data.categories,M.value=e.data.order_items,V.value=e.data.payment_methods,R.value=1,E.value=!1}).catch(e=>{oe(),E.value=!1,m.add({severity:"error",summary:"Erro",detail:`${e.response.data.message}`,life:3e3})})},fe=()=>{O.value=!0,axios.delete(`/api/tables/${H.value}`).then(()=>{P.value.data=P.value.data.filter(a=>a.id!==H.value),G(),m.add({severity:"success",summary:"Sucesso",detail:"Sucesso ao apagar",life:3e3})}).catch(a=>{m.add({severity:"error",summary:"Erro",detail:`${a}`,life:3e3}),O.value=!1}).finally(()=>{O.value=!1})};function be(){T.value=!0,h.back()}const ye=qe(()=>{Y(se.value)},300);return Me(Q,ye),Re(()=>{Y()}),(a,e)=>{const i=Se,v=$e,c=ke,p=Ce,k=Te,ee=De,te=we,y=he,D=xe,ge=_e;return n(),u(g,null,[E.value?(n(),u("div",Be,[t("div",Ne,[t("div",Le,[o(i,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[14]||(e[14]=t("p",null,"Por Favor Aguarde...",-1))])])])):(n(),u("div",Fe,[t("div",Oe,[t("div",Ie,[t("div",Ve,[t("h2",null,[e[15]||(e[15]=_("Resumo da venda ")),S.value>0?(n(),u("div",Ae,[t("strong",null,"Total: "+r(S.value)+" MT",1)])):L("",!0)]),(n(!0),u(g,null,x($.value,(s,b)=>(n(),u("div",{key:b,class:"card bg-gray-100 p-4"},[t("div",null,[t("strong",null,r(s.name),1),t("button",{onClick:C=>pe(b),class:"rounded-full bg-red-100",style:{width:"2.5rem",height:"2.5rem"}},"X",8,Ze)]),t("div",Je,[t("div",null,r(s.quantity)+" x "+r(s.price)+" MT",1),t("div",null,r(s.price*s.quantity)+" MT",1)])]))),128)),S.value>0?(n(),u("div",We,[t("strong",null,"Total: "+r(S.value)+" MT",1),t("button",{disabled:f.value,onClick:re,class:"bg-blue-500 text-white px-4 py-2 rounded-full mt-1",style:{width:"100%"}},e[16]||(e[16]=[_("Adicionar a conta"),t("i",{class:"pi pi-print"},null,-1)]),8,ze),f.value?(n(),u("div",He,[o(i,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})])):L("",!0)])):L("",!0)])]),t("div",Qe,[t("div",Xe,[o(v,{model:le},{end:d(()=>[t("p",null,[e[17]||(e[17]=t("strong",null,"Mesa:",-1)),_(" "+r(Z.value==null?"":Z.value.name)+" | ",1),e[18]||(e[18]=t("strong",null,"Total Consumo:",-1)),_(" "+r(j.value)+" MT",1)])]),_:1})]),t("div",Ge,[o(te,{value:1},{default:d(()=>[o(p,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:d(()=>[(n(!0),u(g,null,x(q.value,s=>(n(),F(c,{key:s.id,value:s.id},{default:d(()=>[_(r(s.name),1)]),_:2},1032,["value"]))),128))]),_:1}),o(ee,null,{default:d(()=>[(n(!0),u(g,null,x(q.value,s=>(n(),F(k,{key:s.id,value:s.id},{default:d(()=>[o(te,{value:0},{default:d(()=>[o(p,{class:"flex overflow-x-auto space-x-4 pb-2"},{default:d(()=>[(n(!0),u(g,null,x(s.sub_categories,b=>(n(),F(c,{key:b.id,value:b.id},{default:d(()=>[_(r(b.name),1)]),_:2},1032,["value"]))),128))]),_:2},1024),o(ee,null,{default:d(()=>[(n(!0),u(g,null,x(s.sub_categories,b=>(n(),F(k,{key:b.id,value:b.id},{default:d(()=>[b.products.length>0?(n(),u("div",Ke,[t("div",Ye,[(n(!0),u(g,null,x(b.products,C=>(n(),u("div",{key:C.id,class:"col-span-12 lg:col-span-6 xl:col-span-3"},[t("div",et,[t("div",tt,[t("img",{src:C.image?`/${C.image}`:"/image/image.png",alt:"Imagem do Produto",class:"w-full h-32 rounded-t-lg"},null,8,st)]),t("div",at,[t("div",lt,r(C.name),1)]),t("div",ot,[t("span",nt,"Preço: "+r(C.price)+" MT",1)]),t("div",it,[t("small",null,"Stock:"+r(C.quantity_in_principal_stock),1)]),t("button",{onClick:Rt=>ce(C),class:"bg-blue-500 text-white px-4 py-2 rounded-full mt-1"}," Adicionar ",8,rt)])]))),128))])])):(n(),u("div",ut,e[19]||(e[19]=[t("p",null,"No products available.",-1)])))]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})])])])])),o(D,{header:"Confirmação",visible:I.value,"onUpdate:visible":e[0]||(e[0]=s=>I.value=s),style:{width:"350px"},modal:!0},{footer:d(()=>[o(y,{label:"Não",icon:"pi pi-times",onClick:G,class:"p-button-text"}),o(y,{label:"Sim",icon:"pi pi-check",onClick:fe,class:"p-button-text",autofocus:""})]),default:d(()=>[e[20]||(e[20]=t("div",{class:"flex align-items-center justify-content-center"},[t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}}),t("span",null,"Tem certeza que deseja proceder?")],-1))]),_:1},8,["visible"]),o(D,{header:"Open File",visible:J.value,"onUpdate:visible":e[2]||(e[2]=s=>J.value=s),style:{width:"30vw"}},{default:d(()=>[e[21]||(e[21]=t("p",null,"Here you can manage your files or perform specific actions.",-1)),o(y,{label:"Close",onClick:e[1]||(e[1]=s=>J.value=!1)})]),_:1},8,["visible"]),o(D,{header:"Consumo da Mesa",visible:B.value,"onUpdate:visible":e[4]||(e[4]=s=>B.value=s),style:{width:"30vw"}},{default:d(()=>[t("div",dt,[e[23]||(e[23]=t("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),t("ul",ct,[(n(!0),u(g,null,x(M.value,s=>(n(),u("li",{key:s.id,class:"flex justify-between border-b pb-2 mt-5"},[t("span",null,r(s.quantity)+" x "+r(s.product.name),1),t("span",null,[_("MZN "+r(s.total)+" ",1),t("i",{class:"pi pi-trash",onClick:b=>ne(s.id)},null,8,pt)])]))),128))]),t("p",mt,[e[22]||(e[22]=t("span",null,"Total: ",-1)),t("span",vt,"MZN "+r(j.value),1)]),t("div",ft,[o(y,{label:"Fechar",onClick:e[3]||(e[3]=s=>B.value=!1),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(D,{header:"Confirmar Exclusão",visible:U.value,"onUpdate:visible":e[7]||(e[7]=s=>U.value=s),style:{width:"20vw"}},{default:d(()=>[t("div",bt,[e[24]||(e[24]=t("p",{class:"mb-4"},[_("Insira o código para confirmar a exclusão do item "),t("strong"),_(".")],-1)),Ue(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>A.value=s),type:"password",placeholder:"Código de confirmação",class:"w-full p-2 border rounded"},null,512),[[Ee,A.value]]),t("div",yt,[o(y,{label:"Cancelar",onClick:e[6]||(e[6]=s=>U.value=!1),class:"bg-gray-300 hover:bg-gray-400 text-black font-semibold px-4 py-2 rounded"}),o(y,{label:"Confirmar",onClick:ie,class:"bg-red-500 hover:bg-red-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(D,{header:"Fechar a conta",visible:N.value,"onUpdate:visible":e[9]||(e[9]=s=>N.value=s),style:{width:"30vw"}},{default:d(()=>[t("div",gt,[e[26]||(e[26]=t("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),t("ul",_t,[(n(!0),u(g,null,x(M.value,s=>(n(),u("li",{key:s.id,class:"flex justify-between border-b pb-2 mt-5"},[t("span",null,r(s.quantity)+" x "+r(s.product.name),1),t("span",null,"MZN "+r(s.total),1)]))),128))]),t("p",xt,[e[25]||(e[25]=t("span",null,"Total: ",-1)),t("span",ht,"MZN "+r(j.value),1)]),t("div",wt,[o(y,{label:"Fechar Conta",onClick:e[8]||(e[8]=s=>ue()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(D,{header:"Fechar a conta",visible:z.value,"onUpdate:visible":e[12]||(e[12]=s=>z.value=s),style:{width:"30vw"}},{default:d(()=>[t("div",kt,[e[28]||(e[28]=t("h3",{class:"text-lg font-bold mb-4"},"Detalhes do Pedido",-1)),t("ul",Ct,[(n(!0),u(g,null,x(M.value,s=>(n(),u("li",{key:s.id,class:"flex justify-between border-b pb-2 mt-5"},[t("span",null,r(s.quantity)+" x "+r(s.product.name),1),t("span",null,"MZN "+r(s.total),1)]))),128))]),o(ge,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=s=>R.value=s),options:V.value,optionLabel:"name",optionValue:"id",class:"mt-2",placeholder:"Selecionar"},null,8,["modelValue","options"]),t("p",Tt,[e[27]||(e[27]=t("span",null,"Total: ",-1)),t("span",Dt,"MZN "+r(j.value),1)]),t("div",$t,[o(y,{label:"Pagar a Conta",onClick:e[11]||(e[11]=s=>de()),class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-4 py-2 rounded"})])])]),_:1},8,["visible"]),o(D,{visible:T.value,"onUpdate:visible":e[13]||(e[13]=s=>T.value=s),header:"Recibo",modal:!0,style:{width:"600px"},closable:!1},{footer:d(()=>[o(y,{label:"Imprimir",icon:"pi pi-print",onClick:me}),o(y,{label:"Fechar",icon:"pi pi-times",class:"p-button-text",onClick:be})]),default:d(()=>[w.value?(n(),u("iframe",{key:0,src:w.value,style:{width:"100%",height:"500px"},frameborder:"0"},null,8,St)):L("",!0)]),_:1},8,["visible"])],64)}}};export{Yt as default};
