import{_ as z,r as u,o as B,c as s,b as a,d as S,w as T,t as p,g as F,h as n,m,e as H,i as h,n as q,p as C,j as N,k as J,l as o,u as L,q as G}from"./app-DIymDWP7.js";const K={id:"app"},Q={class:"main"},W={class:"page-title dark-background",style:{"background-image":"url('/votaaqui/assets/img/events/karaoke.png')","background-size":"cover","background-repeat":"no-repeat","background-position":"center"}},X={class:"container position-relative"},Y={class:"breadcrumbs"},Z={id:"vote-form",class:"buy-tickets section"},ee={class:"container"},ae={class:"row justify-content-center"},te={class:"col-lg-8"},se={class:"ticket-form-wrapper"},oe={key:0,class:"text-center my-5"},le={key:1,class:"alert alert-danger",role:"alert"},ie={key:2},ne={class:"event-info mb-5"},re={key:0},de={key:1},ue={class:"ticket-types"},ve={class:"ticket-option selected"},ce={class:"participant-card"},pe={class:"participant-image"},me=["src","alt"],ge={class:"participant-info"},be={class:"participant-bio"},fe={class:"participant-details"},_e={key:0},ye={key:1},he={key:2},ke={key:0,class:"alert alert-warning mb-4"},we={class:"row"},xe={class:"col-md-6"},Ve={class:"form-group"},Ne=["disabled"],Ee={class:"col-md-6"},Pe={class:"form-group"},Se=["disabled"],Te={class:"col-md-12"},qe={class:"form-group"},Ce=["disabled"],De={class:"terms-checkbox"},Me=["disabled"],Re={class:"newsletter-checkbox"},Ie=["disabled"],$e={key:0,class:"loading"},Ae={key:1,class:"loading"},Oe={key:2,class:"loading"},Ue={key:3,class:"error-message"},je={key:4,class:"error-message"},ze={key:5,class:"sent-message"},Be={class:"form-submit"},Fe=["disabled"],He={key:0,class:"bi bi-credit-card me-2"},Je={key:1,class:"bi bi-check-circle me-2"},Le={key:2,class:"bi bi-cash me-2"},Ge={key:3},Ke={key:4},Qe={key:5},We={key:6},Xe={key:0,class:"mt-2 text-warning small"},Ye={key:2,class:"text-center py-4"},Ze={class:"alert alert-info"},ea={class:"mb-0"},aa={__name:"VotePage",setup(ta){const D=L(),M=G(),E=u(!1),k=u(null),l=u(null),r=u(!1),c=u(null),w=u(!1),f=u(null),g=u(!1),b=u(""),_=u(!1),x=u(!1),P=u(!1);u(null);const t=u({firstName:"",lastName:"",email:"",phone:"",acceptTerms:!1,newsletter:!1}),R=async()=>{try{const i=await N.get("/api/votaaqui/episodes/current");i.data.success&&i.data.data?(f.value=i.data.data,g.value=f.value.voting_open&&f.value.status==="live",g.value||(f.voting_open?f.status!=="live"?b.value="Este episódio não está ativo.":b.value="A votação não está disponível.":b.value="A votação não está aberta no momento.")):(g.value=!1,b.value="Não há votação ativa no momento.")}catch(i){console.error("Error checking voting status:",i),g.value=!1,b.value="Erro ao verificar status da votação."}},I=async()=>{var i,e;try{E.value=!0,k.value=null;const v=D.params.id;if(!v)throw new Error("ID do participante não fornecido");const d=await N.get(`/api/votaaqui/participants/${v}`);l.value=d.data.data,await R()}catch(v){console.error("Error fetching participant:",v),k.value=((e=(i=v.response)==null?void 0:i.data)==null?void 0:e.message)||v.message||"Erro ao carregar participante"}finally{E.value=!1}},$=async()=>{var i,e,v,d;try{if(r.value=!0,c.value=null,w.value=!1,P.value=null,!g.value){c.value=b.value||"A votação não está ativa no momento.",r.value=!1;return}if(!l.value||!l.value.id){c.value="Erro: Dados do participante não encontrados. Recarregue a página.",r.value=!1;return}if(!t.value.phone||t.value.phone.trim()===""){c.value="Número de telefone é obrigatório para o pagamento.",r.value=!1;return}if(!/^[8-9][0-9]{8}$/.test(t.value.phone)){c.value="Número de telefone inválido. Digite 9 dígitos começando com 8 ou 9.",r.value=!1;return}_.value=!0,c.value="Processando pagamento de 50 MT...";const U={amount:50,phone:t.value.phone,description:`Voto para ${l.value.stage_name||l.value.name}`,reference:`VOTE_${l.value.id}`},V=await N.post("/api/votaaqui/payments/process",U);if(!V.data.success)throw new Error(V.data.message||"Falha no pagamento");x.value=!0,_.value=!1,c.value="Pagamento aprovado! Registrando voto...";const j={participant_id:l.value.id,voter_name:`${t.value.firstName} ${t.value.lastName}`,voter_email:t.value.email||null,voter_phone:t.value.phone,newsletter_subscription:t.value.newsletter,payment_reference:V.data.reference,payment_amount:50,payment_phone:t.value.phone},sa=await N.post("/api/votaaqui/votes",j);w.value=!0,localStorage.setItem("votedParticipant",JSON.stringify(l.value)),localStorage.setItem("voteData",JSON.stringify({voter_name:`${t.value.firstName} ${t.value.lastName}`,voter_email:t.value.email,voter_phone:`+258${t.value.phone}`,payment_amount:50,payment_reference:V.data.reference,voted_at:new Date().toISOString()})),setTimeout(()=>{M.push("/voto-sucesso")},1e3)}catch(y){console.error("Vote submission error:",y),_.value?(P.value=!0,_.value=!1,c.value=((e=(i=y.response)==null?void 0:i.data)==null?void 0:e.message)||y.message||"Erro no pagamento. Tente novamente."):c.value=((d=(v=y.response)==null?void 0:v.data)==null?void 0:d.message)||y.message||"Ocorreu um erro ao registrar o voto. Tente novamente.",w.value=!1}finally{r.value=!1}},A=i=>{i.target.src="/votaaqui/assets/img/events/gate1.jpg"},O=i=>{let e=i.target.value;e=e.replace(/\D/g,""),e.length>9&&(e=e.substring(0,9)),t.value.phone=e,i.target.value=e};return B(()=>{I()}),(i,e)=>{const v=J("router-link");return o(),s("div",K,[a("main",Q,[a("div",W,[a("div",X,[e[7]||(e[7]=a("h1",{style:{color:"white"}},"Vote no seu participante",-1)),e[8]||(e[8]=a("p",null,"Complete os dados para confirmar o seu voto.",-1)),a("nav",Y,[a("ol",null,[a("li",null,[S(v,{to:"/"},{default:T(()=>e[5]||(e[5]=[n("Home")])),_:1})]),e[6]||(e[6]=a("li",{class:"current"},"Seu voto",-1))])])])]),a("section",Z,[a("div",ee,[a("div",ae,[a("div",te,[a("div",se,[E.value?(o(),s("div",oe,e[9]||(e[9]=[a("div",{class:"spinner-border",role:"status"},[a("span",{class:"visually-hidden"},"Carregando...")],-1),a("p",{class:"mt-3"},"Carregando informações do participante...",-1)]))):k.value?(o(),s("div",le,[e[11]||(e[11]=a("h5",null,"Erro ao carregar participante",-1)),a("p",null,p(k.value),1),S(v,{to:"/",class:"btn btn-outline-danger"},{default:T(()=>e[10]||(e[10]=[a("i",{class:"bi bi-arrow-left me-1"},null,-1),n(" Voltar à página inicial ")])),_:1})])):l.value?(o(),s("div",ie,[a("div",ne,[e[12]||(e[12]=a("h3",null,"Reality Show - Estrelas do LIV",-1)),f.value?(o(),s("h4",re,[a("strong",null,p(f.value.title),1)])):(o(),s("h4",de,"Nenhuma gala disponivel")),e[13]||(e[13]=F('<div class="event-details" data-v-9debe592><div class="event-meta" data-v-9debe592><span data-v-9debe592><i class="bi bi-calendar-event" data-v-9debe592></i> Setembro 2025</span><span data-v-9debe592><i class="bi bi-geo-alt" data-v-9debe592></i> Moçambique</span><span data-v-9debe592><i class="bi bi-clock" data-v-9debe592></i> Votação 24h</span></div></div>',1))]),a("div",ue,[e[17]||(e[17]=a("h4",null,"Participante selecionado",-1)),a("div",ve,[a("div",ce,[a("div",pe,[a("img",{src:l.value.photo_url||"/votaaqui/assets/img/events/gate1.jpg",alt:l.value.name,class:"img-fluid",onError:A},null,40,me)]),a("div",ge,[a("h5",null,p(l.value.stage_name||l.value.name),1),a("p",be,p(l.value.biography||"Participante do Reality Show"),1),a("div",fe,[l.value.age?(o(),s("span",_e,[e[14]||(e[14]=a("i",{class:"bi bi-person"},null,-1)),n(" "+p(l.value.age)+" anos ",1)])):m("",!0),l.value.city?(o(),s("span",ye,[e[15]||(e[15]=a("i",{class:"bi bi-geo-alt"},null,-1)),n(" "+p(l.value.city),1)])):m("",!0),l.value.skills?(o(),s("span",he,[e[16]||(e[16]=a("i",{class:"bi bi-star"},null,-1)),n(" "+p(l.value.skills),1)])):m("",!0)])])])])]),g.value?m("",!0):(o(),s("div",ke,[e[18]||(e[18]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),n(" "+p(b.value),1)])),g.value?(o(),s("form",{key:1,onSubmit:H($,["prevent"]),class:"php-email-form ticket-form"},[a("div",we,[a("div",xe,[a("div",Ve,[e[19]||(e[19]=a("label",{for:"first_name"},"Nome *",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=d=>t.value.firstName=d),id:"first_name",class:"form-control",placeholder:"Seu primeiro nome",required:"",disabled:r.value},null,8,Ne),[[q,t.value.firstName]])])]),a("div",Ee,[a("div",Pe,[e[20]||(e[20]=a("label",{for:"last_name"},"Apelido *",-1)),h(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=d=>t.value.lastName=d),id:"last_name",class:"form-control",placeholder:"Seu apelido",required:"",disabled:r.value},null,8,Se),[[q,t.value.lastName]])])]),a("div",Te,[a("div",qe,[e[21]||(e[21]=a("label",{for:"phone"},"Contacto (Número de Carteira Móvel) *",-1)),h(a("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=d=>t.value.phone=d),id:"phone",class:"form-control",placeholder:"841234567",required:"",disabled:r.value,onInput:O,pattern:"[0-9]{9}",minlength:"9",maxlength:"9"},null,40,Ce),[[q,t.value.phone]]),e[22]||(e[22]=a("small",{class:"form-text text-muted"}," Digite apenas números (9 dígitos). Ex: 841234567 ",-1))])])]),e[31]||(e[31]=a("div",{class:"payment-info"},[a("div",{class:"tax-note"},"*Voto com pagamento de 50 MT via carteira móvel"),a("small",{class:"text-muted"},"O seu voto será contabilizado apenas após confirmação do pagamento.")],-1)),a("div",De,[h(a("input",{type:"checkbox",id:"terms","onUpdate:modelValue":e[3]||(e[3]=d=>t.value.acceptTerms=d),required:"",disabled:r.value},null,8,Me),[[C,t.value.acceptTerms]]),e[23]||(e[23]=a("label",{for:"terms"},[n(" Concordo com os "),a("a",{href:"#",target:"_blank"},"Termos e Condições"),n(" e "),a("a",{href:"#",target:"_blank"},"Política de Privacidade"),n(" * ")],-1))]),a("div",Re,[h(a("input",{type:"checkbox",id:"newsletter","onUpdate:modelValue":e[4]||(e[4]=d=>t.value.newsletter=d),disabled:r.value},null,8,Ie),[[C,t.value.newsletter]]),e[24]||(e[24]=a("label",{for:"newsletter"}," Subscrever newsletter para atualizações do evento ",-1))]),_.value?(o(),s("div",$e,e[25]||(e[25]=[a("i",{class:"bi bi-credit-card me-2"},null,-1),n(" Processando pagamento de 50 MT... ")]))):x.value&&r.value?(o(),s("div",Ae,e[26]||(e[26]=[a("i",{class:"bi bi-check-circle me-2"},null,-1),n(" Pagamento aprovado! Registrando voto... ")]))):r.value?(o(),s("div",Oe,e[27]||(e[27]=[a("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),n(" Enviando voto... ")]))):m("",!0),P.value?(o(),s("div",Ue,[e[28]||(e[28]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),n(" "+p(c.value),1)])):c.value?(o(),s("div",je,[e[29]||(e[29]=a("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),n(" "+p(c.value),1)])):m("",!0),w.value?(o(),s("div",ze,e[30]||(e[30]=[a("i",{class:"bi bi-check-circle-fill me-2"},null,-1),n(" Pagamento e voto confirmados! Redirecionando... ")]))):m("",!0),a("div",Be,[a("button",{type:"submit",class:"btn-submit",disabled:r.value||!t.value.acceptTerms||!l.value||!l.value.id||!t.value.phone.trim()||!g.value},[_.value?(o(),s("i",He)):x.value?(o(),s("i",Je)):(o(),s("i",Le)),_.value?(o(),s("span",Ge,"Processando Pagamento...")):x.value?(o(),s("span",Ke,"Registrando Voto...")):r.value?(o(),s("span",Qe,"Enviando...")):(o(),s("span",We,"Pagar 50 MT e Votar"))],8,Fe),!l.value||!l.value.id?(o(),s("div",Xe," ⚠️ Aguardando carregamento dos dados do participante... ")):m("",!0)])],32)):m("",!0),g.value?m("",!0):(o(),s("div",Ye,[a("div",Ze,[e[33]||(e[33]=a("h5",null,[a("i",{class:"bi bi-info-circle me-2"}),n("Votação Indisponível")],-1)),a("p",ea,p(b.value),1),S(v,{to:"/",class:"btn btn-outline-primary mt-3"},{default:T(()=>e[32]||(e[32]=[a("i",{class:"bi bi-arrow-left me-2"},null,-1),n("Voltar à Homepage ")])),_:1})])]))])):m("",!0)])])])])])])])}}},la=z(aa,[["__scopeId","data-v-9debe592"]]);export{la as default};
