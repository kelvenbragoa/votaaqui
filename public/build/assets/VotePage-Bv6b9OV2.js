import{_ as z,r as v,o as B,c as o,b as a,d as E,w as S,t as m,g as F,h as n,m as p,e as H,i as y,n as T,p as R,j as V,k as J,l,u as L,q as G}from"./app-BK5PDX-r.js";const K={id:"app"},Q={class:"main"},W={class:"page-title dark-background",style:{"background-image":"url('/votaaqui/assets/img/events/karaoke.png')","background-size":"cover","background-repeat":"no-repeat","background-position":"center"}},X={class:"container position-relative"},Y={class:"breadcrumbs"},Z={id:"vote-form",class:"buy-tickets section"},ee={class:"container"},ae={class:"row justify-content-center"},te={class:"col-lg-8"},se={class:"ticket-form-wrapper"},oe={key:0,class:"text-center my-5"},le={key:1,class:"alert alert-danger",role:"alert"},ie={key:2},ne={class:"ticket-types"},re={class:"ticket-option selected"},de={class:"participant-card"},ue={class:"participant-image"},ve=["src","alt"],ce={class:"participant-info"},pe={class:"participant-bio"},me={class:"participant-details"},ge={key:0},fe={key:1},be={key:2},_e={key:0,class:"alert alert-warning mb-4"},ye={class:"row"},he={class:"col-md-6"},ke={class:"form-group"},we=["disabled"],xe={class:"col-md-6"},Ve={class:"form-group"},Pe=["disabled"],Ne={class:"col-md-12"},Ee={class:"form-group"},Se=["disabled"],Te={class:"terms-checkbox"},qe=["disabled"],De={class:"newsletter-checkbox"},Ie=["disabled"],Re={key:0,class:"loading"},Ce={key:1,class:"loading"},Me={key:2,class:"loading"},$e={key:3,class:"error-message"},Ae={key:4,class:"error-message"},Oe={key:5,class:"sent-message"},Ue={class:"form-submit"},je=["disabled"],ze={key:0,class:"bi bi-credit-card me-2"},Be={key:1,class:"bi bi-check-circle me-2"},Fe={key:2,class:"bi bi-cash me-2"},He={key:3},Je={key:4},Le={key:5},Ge={key:6},Ke={key:0,class:"mt-2 text-warning small"},Qe={key:2,class:"text-center py-4"},We={class:"alert alert-info"},Xe={class:"mb-0"},Ye={__name:"VotePage",setup(Ze){const C=L(),M=G(),P=v(!1),h=v(null),t=v(null),r=v(!1),c=v(null),k=v(!1),g=v(!1),f=v(""),b=v(!1),w=v(!1),N=v(!1);v(null);const s=v({firstName:"",lastName:"",email:"",phone:"",acceptTerms:!1,newsletter:!1}),$=async()=>{try{const i=await V.get("/api/votaaqui/episodes/current");if(i.data.success&&i.data.data){const e=i.data.data;g.value=e.voting_open&&e.status==="live",g.value||(e.voting_open?e.status!=="live"?f.value="Este episódio não está ativo.":f.value="A votação não está disponível.":f.value="A votação não está aberta no momento.")}else g.value=!1,f.value="Não há votação ativa no momento."}catch(i){console.error("Error checking voting status:",i),g.value=!1,f.value="Erro ao verificar status da votação."}},A=async()=>{var i,e;try{P.value=!0,h.value=null;const d=C.params.id;if(!d)throw new Error("ID do participante não fornecido");console.log("Fetching participant with ID:",d);const u=await V.get(`/api/votaaqui/participants/${d}`);t.value=u.data.data,console.log("Participant loaded:",t.value),await $()}catch(d){console.error("Error fetching participant:",d),h.value=((e=(i=d.response)==null?void 0:i.data)==null?void 0:e.message)||d.message||"Erro ao carregar participante"}finally{P.value=!1}},O=async()=>{var i,e,d,u,q;try{if(r.value=!0,c.value=null,k.value=!1,N.value=null,!g.value){c.value=f.value||"A votação não está ativa no momento.",r.value=!1;return}if(console.log("Participant data:",t.value),console.log("Participant ID:",(i=t.value)==null?void 0:i.id),!t.value||!t.value.id){c.value="Erro: Dados do participante não encontrados. Recarregue a página.",r.value=!1;return}if(!s.value.phone||s.value.phone.trim()===""){c.value="Número de telefone é obrigatório para o pagamento.",r.value=!1;return}if(!/^[8-9][0-9]{8}$/.test(s.value.phone)){c.value="Número de telefone inválido. Digite 9 dígitos começando com 8 ou 9.",r.value=!1;return}b.value=!0,c.value="Processando pagamento de 50 MT...";const D={amount:50,phone:s.value.phone,description:`Voto para ${t.value.stage_name||t.value.name}`,reference:`VOTE_${t.value.id}`};console.log("Processing payment:",D);const x=await V.post("/api/votaaqui/payments/process",D);if(!x.data.success)throw new Error(x.data.message||"Falha no pagamento");w.value=!0,b.value=!1,c.value="Pagamento aprovado! Registrando voto...";const I={participant_id:t.value.id,voter_name:`${s.value.firstName} ${s.value.lastName}`,voter_email:s.value.email||null,voter_phone:s.value.phone,newsletter_subscription:s.value.newsletter,payment_reference:x.data.reference,payment_amount:50,payment_phone:s.value.phone};console.log("Registering vote with payment:",I);const ea=await V.post("/api/votaaqui/votes",I);k.value=!0,localStorage.setItem("votedParticipant",JSON.stringify(t.value)),localStorage.setItem("voteData",JSON.stringify({voter_name:`${s.value.firstName} ${s.value.lastName}`,voter_email:s.value.email,voter_phone:`+258${s.value.phone}`,payment_amount:50,payment_reference:x.data.reference,voted_at:new Date().toISOString()})),setTimeout(()=>{M.push("/voto-sucesso")},1e3)}catch(_){console.error("Vote submission error:",_),b.value?(N.value=!0,b.value=!1,c.value=((d=(e=_.response)==null?void 0:e.data)==null?void 0:d.message)||_.message||"Erro no pagamento. Tente novamente."):c.value=((q=(u=_.response)==null?void 0:u.data)==null?void 0:q.message)||_.message||"Ocorreu um erro ao registrar o voto. Tente novamente.",k.value=!1}finally{r.value=!1}},U=i=>{i.target.src="/votaaqui/assets/img/events/gate1.jpg"},j=i=>{let e=i.target.value;e=e.replace(/\D/g,""),e.length>9&&(e=e.substring(0,9)),s.value.phone=e,i.target.value=e};return B(()=>{A()}),(i,e)=>{const d=J("router-link");return l(),o("div",K,[a("main",Q,[a("div",W,[a("div",X,[e[7]||(e[7]=a("h1",{style:{color:"white"}},"Vote no seu participante",-1)),e[8]||(e[8]=a("p",null,"Complete os dados para confirmar o seu voto.",-1)),a("nav",Y,[a("ol",null,[a("li",null,[E(d,{to:"/"},{default:S(()=>e[5]||(e[5]=[n("Home")])),_:1})]),e[6]||(e[6]=a("li",{class:"current"},"Seu voto",-1))])])])]),a("section",Z,[a("div",ee,[a("div",ae,[a("div",te,[a("div",se,[P.value?(l(),o("div",oe,e[9]||(e[9]=[a("div",{class:"spinner-border",role:"status"},[a("span",{class:"visually-hidden"},"Carregando...")],-1),a("p",{class:"mt-3"},"Carregando informações do participante...",-1)]))):h.value?(l(),o("div",le,[e[11]||(e[11]=a("h5",null,"Erro ao carregar participante",-1)),a("p",null,m(h.value),1),E(d,{to:"/",class:"btn btn-outline-danger"},{default:S(()=>e[10]||(e[10]=[a("i",{class:"bi bi-arrow-left me-1"},null,-1),n(" Voltar à página inicial ")])),_:1})])):t.value?(l(),o("div",ie,[e[32]||(e[32]=F('<div class="event-info mb-5" data-v-e3f4dc28><h3 data-v-e3f4dc28>Reality Show - Estrelas do LIV</h3><div class="event-details" data-v-e3f4dc28><div class="event-meta" data-v-e3f4dc28><span data-v-e3f4dc28><i class="bi bi-calendar-event" data-v-e3f4dc28></i> Setembro 2025</span><span data-v-e3f4dc28><i class="bi bi-geo-alt" data-v-e3f4dc28></i> Moçambique</span><span data-v-e3f4dc28><i class="bi bi-clock" data-v-e3f4dc28></i> Votação 24h</span></div></div></div>',1)),a("div",ne,[e[15]||(e[15]=a("h4",null,"Participante selecionado",-1)),a("div",re,[a("div",de,[a("div",ue,[a("img",{src:t.value.photo_url||"/votaaqui/assets/img/events/gate1.jpg",alt:t.value.name,class:"img-fluid",onError:U},null,40,ve)]),a("div",ce,[a("h5",null,m(t.value.stage_name||t.value.name),1),a("p",pe,m(t.value.biography||"Participante do Reality Show"),1),a("div",me,[t.value.age?(l(),o("span",ge,[e[12]||(e[12]=a("i",{class:"bi bi-person"},null,-1)),n(" "+m(t.value.age)+" anos ",1)])):p("",!0),t.value.city?(l(),o("span",fe,[e[13]||(e[13]=a("i",{class:"bi bi-geo-alt"},null,-1)),n(" "+m(t.value.city),1)])):p("",!0),t.value.skills?(l(),o("span",be,[e[14]||(e[14]=a("i",{class:"bi bi-star"},null,-1)),n(" "+m(t.value.skills),1)])):p("",!0)])])])])]),g.value?p("",!0):(l(),o("div",_e,[e[16]||(e[16]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),n(" "+m(f.value),1)])),g.value?(l(),o("form",{key:1,onSubmit:H(O,["prevent"]),class:"php-email-form ticket-form"},[a("div",ye,[a("div",he,[a("div",ke,[e[17]||(e[17]=a("label",{for:"first_name"},"Nome *",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=u=>s.value.firstName=u),id:"first_name",class:"form-control",placeholder:"Seu primeiro nome",required:"",disabled:r.value},null,8,we),[[T,s.value.firstName]])])]),a("div",xe,[a("div",Ve,[e[18]||(e[18]=a("label",{for:"last_name"},"Apelido *",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=u=>s.value.lastName=u),id:"last_name",class:"form-control",placeholder:"Seu apelido",required:"",disabled:r.value},null,8,Pe),[[T,s.value.lastName]])])]),a("div",Ne,[a("div",Ee,[e[19]||(e[19]=a("label",{for:"phone"},"Contacto (Número de Carteira Móvel) *",-1)),y(a("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=u=>s.value.phone=u),id:"phone",class:"form-control",placeholder:"841234567",required:"",disabled:r.value,onInput:j,pattern:"[0-9]{9}",minlength:"9",maxlength:"9"},null,40,Se),[[T,s.value.phone]]),e[20]||(e[20]=a("small",{class:"form-text text-muted"}," Digite apenas números (9 dígitos). Ex: 841234567 ",-1))])])]),e[29]||(e[29]=a("div",{class:"payment-info"},[a("div",{class:"tax-note"},"*Voto com pagamento de 50 MT via carteira móvel"),a("small",{class:"text-muted"},"O seu voto será contabilizado apenas após confirmação do pagamento.")],-1)),a("div",Te,[y(a("input",{type:"checkbox",id:"terms","onUpdate:modelValue":e[3]||(e[3]=u=>s.value.acceptTerms=u),required:"",disabled:r.value},null,8,qe),[[R,s.value.acceptTerms]]),e[21]||(e[21]=a("label",{for:"terms"},[n(" Concordo com os "),a("a",{href:"#",target:"_blank"},"Termos e Condições"),n(" e "),a("a",{href:"#",target:"_blank"},"Política de Privacidade"),n(" * ")],-1))]),a("div",De,[y(a("input",{type:"checkbox",id:"newsletter","onUpdate:modelValue":e[4]||(e[4]=u=>s.value.newsletter=u),disabled:r.value},null,8,Ie),[[R,s.value.newsletter]]),e[22]||(e[22]=a("label",{for:"newsletter"}," Subscrever newsletter para atualizações do evento ",-1))]),b.value?(l(),o("div",Re,e[23]||(e[23]=[a("i",{class:"bi bi-credit-card me-2"},null,-1),n(" Processando pagamento de 50 MT... ")]))):w.value&&r.value?(l(),o("div",Ce,e[24]||(e[24]=[a("i",{class:"bi bi-check-circle me-2"},null,-1),n(" Pagamento aprovado! Registrando voto... ")]))):r.value?(l(),o("div",Me,e[25]||(e[25]=[a("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),n(" Enviando voto... ")]))):p("",!0),N.value?(l(),o("div",$e,[e[26]||(e[26]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),n(" "+m(c.value),1)])):c.value?(l(),o("div",Ae,[e[27]||(e[27]=a("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),n(" "+m(c.value),1)])):p("",!0),k.value?(l(),o("div",Oe,e[28]||(e[28]=[a("i",{class:"bi bi-check-circle-fill me-2"},null,-1),n(" Pagamento e voto confirmados! Redirecionando... ")]))):p("",!0),a("div",Ue,[a("button",{type:"submit",class:"btn-submit",disabled:r.value||!s.value.acceptTerms||!t.value||!t.value.id||!s.value.phone.trim()||!g.value},[b.value?(l(),o("i",ze)):w.value?(l(),o("i",Be)):(l(),o("i",Fe)),b.value?(l(),o("span",He,"Processando Pagamento...")):w.value?(l(),o("span",Je,"Registrando Voto...")):r.value?(l(),o("span",Le,"Enviando...")):(l(),o("span",Ge,"Pagar 50 MT e Votar"))],8,je),!t.value||!t.value.id?(l(),o("div",Ke," ⚠️ Aguardando carregamento dos dados do participante... ")):p("",!0)])],32)):p("",!0),g.value?p("",!0):(l(),o("div",Qe,[a("div",We,[e[31]||(e[31]=a("h5",null,[a("i",{class:"bi bi-info-circle me-2"}),n("Votação Indisponível")],-1)),a("p",Xe,m(f.value),1),E(d,{to:"/",class:"btn btn-outline-primary mt-3"},{default:S(()=>e[30]||(e[30]=[a("i",{class:"bi bi-arrow-left me-2"},null,-1),n("Voltar à Homepage ")])),_:1})])]))])):p("",!0)])])])])])])])}}},ta=z(Ye,[["__scopeId","data-v-e3f4dc28"]]);export{ta as default};
