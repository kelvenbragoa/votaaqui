import{_ as B,r as v,o as F,c as o,b as a,d as S,w as T,t as m,g as j,h as n,m as p,e as H,i as y,n as x,p as R,j as P,k as J,l,u as L,q as G}from"./app-DuMqQ7Hz.js";const K={id:"app"},Q={class:"main"},W={class:"page-title dark-background",style:{"background-image":"url('/votaaqui/assets/img/events/karaoke.png')","background-size":"cover","background-repeat":"no-repeat","background-position":"center"}},X={class:"container position-relative"},Y={class:"breadcrumbs"},Z={id:"vote-form",class:"buy-tickets section"},ee={class:"container"},ae={class:"row justify-content-center"},te={class:"col-lg-8"},se={class:"ticket-form-wrapper"},oe={key:0,class:"text-center my-5"},le={key:1,class:"alert alert-danger",role:"alert"},ie={key:2},ne={class:"ticket-types"},re={class:"ticket-option selected"},de={class:"participant-card"},ue={class:"participant-image"},ve=["src","alt"],ce={class:"participant-info"},pe={class:"participant-bio"},me={class:"participant-details"},ge={key:0},be={key:1},fe={key:2},_e={key:0,class:"alert alert-warning mb-4"},ye={class:"row"},he={class:"col-md-6"},ke={class:"form-group"},we=["disabled"],Ve={class:"col-md-6"},xe={class:"form-group"},Pe=["disabled"],Ne={class:"col-md-6"},Ee={class:"form-group"},Se=["disabled"],Te={class:"col-md-6"},qe={class:"form-group"},De=["disabled"],Ie={class:"terms-checkbox"},Re=["disabled"],Ce={class:"newsletter-checkbox"},Me=["disabled"],$e={key:0,class:"loading"},Ae={key:1,class:"loading"},Oe={key:2,class:"loading"},Ue={key:3,class:"error-message"},ze={key:4,class:"error-message"},Be={key:5,class:"sent-message"},Fe={class:"form-submit"},je=["disabled"],He={key:0,class:"bi bi-credit-card me-2"},Je={key:1,class:"bi bi-check-circle me-2"},Le={key:2,class:"bi bi-cash me-2"},Ge={key:3},Ke={key:4},Qe={key:5},We={key:6},Xe={key:0,class:"mt-2 text-warning small"},Ye={key:2,class:"text-center py-4"},Ze={class:"alert alert-info"},ea={class:"mb-0"},aa={__name:"VotePage",setup(ta){const C=L(),M=G(),N=v(!1),h=v(null),s=v(null),r=v(!1),c=v(null),k=v(!1),g=v(!1),b=v(""),f=v(!1),w=v(!1),E=v(!1);v(null);const t=v({firstName:"",lastName:"",email:"",phone:"",acceptTerms:!1,newsletter:!1}),$=async()=>{try{const i=await P.get("/api/votaaqui/episodes/current");if(i.data.success&&i.data.data){const e=i.data.data;g.value=e.voting_open&&e.status==="live",g.value||(e.voting_open?e.status!=="live"?b.value="Este episódio não está ativo.":b.value="A votação não está disponível.":b.value="A votação não está aberta no momento.")}else g.value=!1,b.value="Não há votação ativa no momento."}catch(i){console.error("Error checking voting status:",i),g.value=!1,b.value="Erro ao verificar status da votação."}},A=async()=>{var i,e;try{N.value=!0,h.value=null;const u=C.params.id;if(!u)throw new Error("ID do participante não fornecido");console.log("Fetching participant with ID:",u);const d=await P.get(`/api/votaaqui/participants/${u}`);s.value=d.data.data,console.log("Participant loaded:",s.value),await $()}catch(u){console.error("Error fetching participant:",u),h.value=((e=(i=u.response)==null?void 0:i.data)==null?void 0:e.message)||u.message||"Erro ao carregar participante"}finally{N.value=!1}},O=async()=>{var i,e,u,d,q;try{if(r.value=!0,c.value=null,k.value=!1,E.value=null,!g.value){c.value=b.value||"A votação não está ativa no momento.",r.value=!1;return}if(console.log("Participant data:",s.value),console.log("Participant ID:",(i=s.value)==null?void 0:i.id),!s.value||!s.value.id){c.value="Erro: Dados do participante não encontrados. Recarregue a página.",r.value=!1;return}if(!t.value.phone||t.value.phone.trim()===""){c.value="Número de telefone é obrigatório para o pagamento.",r.value=!1;return}if(!/^[8-9][0-9]{8}$/.test(t.value.phone)){c.value="Número de telefone inválido. Digite 9 dígitos começando com 8 ou 9.",r.value=!1;return}f.value=!0,c.value="Processando pagamento de 50 MT...";const D={amount:50,phone:t.value.phone,description:`Voto para ${s.value.stage_name||s.value.name}`,reference:`VOTE_${s.value.id}`};console.log("Processing payment:",D);const V=await P.post("/api/votaaqui/payments/process",D);if(!V.data.success)throw new Error(V.data.message||"Falha no pagamento");w.value=!0,f.value=!1,c.value="Pagamento aprovado! Registrando voto...";const I={participant_id:s.value.id,voter_name:`${t.value.firstName} ${t.value.lastName}`,voter_email:t.value.email||null,voter_phone:t.value.phone,newsletter_subscription:t.value.newsletter,payment_reference:V.data.reference,payment_amount:50,payment_phone:t.value.phone};console.log("Registering vote with payment:",I);const sa=await P.post("/api/votaaqui/votes",I);k.value=!0,localStorage.setItem("votedParticipant",JSON.stringify(s.value)),localStorage.setItem("voteData",JSON.stringify({voter_name:`${t.value.firstName} ${t.value.lastName}`,voter_email:t.value.email,voter_phone:`+258${t.value.phone}`,payment_amount:50,payment_reference:V.data.reference,voted_at:new Date().toISOString()})),setTimeout(()=>{M.push("/voto-sucesso")},1e3)}catch(_){console.error("Vote submission error:",_),f.value?(E.value=!0,f.value=!1,c.value=((u=(e=_.response)==null?void 0:e.data)==null?void 0:u.message)||_.message||"Erro no pagamento. Tente novamente."):c.value=((q=(d=_.response)==null?void 0:d.data)==null?void 0:q.message)||_.message||"Ocorreu um erro ao registrar o voto. Tente novamente.",k.value=!1}finally{r.value=!1}},U=i=>{i.target.src="/votaaqui/assets/img/events/speaker-4.webp"},z=i=>{let e=i.target.value;e=e.replace(/\D/g,""),e.length>9&&(e=e.substring(0,9)),t.value.phone=e,i.target.value=e};return F(()=>{A()}),(i,e)=>{const u=J("router-link");return l(),o("div",K,[a("main",Q,[a("div",W,[a("div",X,[e[8]||(e[8]=a("h1",{style:{color:"white"}},"Vote no seu participante",-1)),e[9]||(e[9]=a("p",null,"Complete os dados para confirmar o seu voto.",-1)),a("nav",Y,[a("ol",null,[a("li",null,[S(u,{to:"/"},{default:T(()=>e[6]||(e[6]=[n("Home")])),_:1})]),e[7]||(e[7]=a("li",{class:"current"},"Seu voto",-1))])])])]),a("section",Z,[a("div",ee,[a("div",ae,[a("div",te,[a("div",se,[N.value?(l(),o("div",oe,e[10]||(e[10]=[a("div",{class:"spinner-border",role:"status"},[a("span",{class:"visually-hidden"},"Carregando...")],-1),a("p",{class:"mt-3"},"Carregando informações do participante...",-1)]))):h.value?(l(),o("div",le,[e[12]||(e[12]=a("h5",null,"Erro ao carregar participante",-1)),a("p",null,m(h.value),1),S(u,{to:"/",class:"btn btn-outline-danger"},{default:T(()=>e[11]||(e[11]=[a("i",{class:"bi bi-arrow-left me-1"},null,-1),n(" Voltar à página inicial ")])),_:1})])):s.value?(l(),o("div",ie,[e[34]||(e[34]=j('<div class="event-info mb-5" data-v-cf15b995><h3 data-v-cf15b995>Reality Show - Estrelas do LIV</h3><div class="event-details" data-v-cf15b995><div class="event-meta" data-v-cf15b995><span data-v-cf15b995><i class="bi bi-calendar-event" data-v-cf15b995></i> Setembro 2025</span><span data-v-cf15b995><i class="bi bi-geo-alt" data-v-cf15b995></i> Moçambique</span><span data-v-cf15b995><i class="bi bi-clock" data-v-cf15b995></i> Votação 24h</span></div></div></div>',1)),a("div",ne,[e[16]||(e[16]=a("h4",null,"Participante selecionado",-1)),a("div",re,[a("div",de,[a("div",ue,[a("img",{src:s.value.photo_url||"/votaaqui/assets/img/events/speaker-4.webp",alt:s.value.name,class:"img-fluid",onError:U},null,40,ve)]),a("div",ce,[a("h5",null,m(s.value.stage_name||s.value.name),1),a("p",pe,m(s.value.biography||"Participante do Reality Show"),1),a("div",me,[s.value.age?(l(),o("span",ge,[e[13]||(e[13]=a("i",{class:"bi bi-person"},null,-1)),n(" "+m(s.value.age)+" anos ",1)])):p("",!0),s.value.city?(l(),o("span",be,[e[14]||(e[14]=a("i",{class:"bi bi-geo-alt"},null,-1)),n(" "+m(s.value.city),1)])):p("",!0),s.value.skills?(l(),o("span",fe,[e[15]||(e[15]=a("i",{class:"bi bi-star"},null,-1)),n(" "+m(s.value.skills),1)])):p("",!0)])])])])]),g.value?p("",!0):(l(),o("div",_e,[e[17]||(e[17]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),n(" "+m(b.value),1)])),g.value?(l(),o("form",{key:1,onSubmit:H(O,["prevent"]),class:"php-email-form ticket-form"},[a("div",ye,[a("div",he,[a("div",ke,[e[18]||(e[18]=a("label",{for:"first_name"},"Nome *",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=d=>t.value.firstName=d),id:"first_name",class:"form-control",placeholder:"Seu primeiro nome",required:"",disabled:r.value},null,8,we),[[x,t.value.firstName]])])]),a("div",Ve,[a("div",xe,[e[19]||(e[19]=a("label",{for:"last_name"},"Apelido *",-1)),y(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=d=>t.value.lastName=d),id:"last_name",class:"form-control",placeholder:"Seu apelido",required:"",disabled:r.value},null,8,Pe),[[x,t.value.lastName]])])]),a("div",Ne,[a("div",Ee,[e[20]||(e[20]=a("label",{for:"email"},"Email",-1)),y(a("input",{type:"email","onUpdate:modelValue":e[2]||(e[2]=d=>t.value.email=d),id:"email",class:"form-control",placeholder:"seu@email.com",disabled:r.value},null,8,Se),[[x,t.value.email]])])]),a("div",Te,[a("div",qe,[e[21]||(e[21]=a("label",{for:"phone"},"Contacto (Número de Carteira Móvel) *",-1)),y(a("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=d=>t.value.phone=d),id:"phone",class:"form-control",placeholder:"841234567",required:"",disabled:r.value,onInput:z,pattern:"[0-9]{9}",minlength:"9",maxlength:"9"},null,40,De),[[x,t.value.phone]]),e[22]||(e[22]=a("small",{class:"form-text text-muted"}," Digite apenas números (9 dígitos). Ex: 841234567 ",-1))])])]),e[31]||(e[31]=a("div",{class:"payment-info"},[a("div",{class:"tax-note"},"*Voto com pagamento de 50 MT via carteira móvel"),a("small",{class:"text-muted"},"O seu voto será contabilizado apenas após confirmação do pagamento.")],-1)),a("div",Ie,[y(a("input",{type:"checkbox",id:"terms","onUpdate:modelValue":e[4]||(e[4]=d=>t.value.acceptTerms=d),required:"",disabled:r.value},null,8,Re),[[R,t.value.acceptTerms]]),e[23]||(e[23]=a("label",{for:"terms"},[n(" Concordo com os "),a("a",{href:"#",target:"_blank"},"Termos e Condições"),n(" e "),a("a",{href:"#",target:"_blank"},"Política de Privacidade"),n(" * ")],-1))]),a("div",Ce,[y(a("input",{type:"checkbox",id:"newsletter","onUpdate:modelValue":e[5]||(e[5]=d=>t.value.newsletter=d),disabled:r.value},null,8,Me),[[R,t.value.newsletter]]),e[24]||(e[24]=a("label",{for:"newsletter"}," Subscrever newsletter para atualizações do evento ",-1))]),f.value?(l(),o("div",$e,e[25]||(e[25]=[a("i",{class:"bi bi-credit-card me-2"},null,-1),n(" Processando pagamento de 50 MT... ")]))):w.value&&r.value?(l(),o("div",Ae,e[26]||(e[26]=[a("i",{class:"bi bi-check-circle me-2"},null,-1),n(" Pagamento aprovado! Registrando voto... ")]))):r.value?(l(),o("div",Oe,e[27]||(e[27]=[a("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),n(" Enviando voto... ")]))):p("",!0),E.value?(l(),o("div",Ue,[e[28]||(e[28]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),n(" "+m(c.value),1)])):c.value?(l(),o("div",ze,[e[29]||(e[29]=a("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),n(" "+m(c.value),1)])):p("",!0),k.value?(l(),o("div",Be,e[30]||(e[30]=[a("i",{class:"bi bi-check-circle-fill me-2"},null,-1),n(" Pagamento e voto confirmados! Redirecionando... ")]))):p("",!0),a("div",Fe,[a("button",{type:"submit",class:"btn-submit",disabled:r.value||!t.value.acceptTerms||!s.value||!s.value.id||!t.value.phone.trim()||!g.value},[f.value?(l(),o("i",He)):w.value?(l(),o("i",Je)):(l(),o("i",Le)),f.value?(l(),o("span",Ge,"Processando Pagamento...")):w.value?(l(),o("span",Ke,"Registrando Voto...")):r.value?(l(),o("span",Qe,"Enviando...")):(l(),o("span",We,"Pagar 50 MT e Votar"))],8,je),!s.value||!s.value.id?(l(),o("div",Xe," ⚠️ Aguardando carregamento dos dados do participante... ")):p("",!0)])],32)):p("",!0),g.value?p("",!0):(l(),o("div",Ye,[a("div",Ze,[e[33]||(e[33]=a("h5",null,[a("i",{class:"bi bi-info-circle me-2"}),n("Votação Indisponível")],-1)),a("p",ea,m(b.value),1),S(u,{to:"/",class:"btn btn-outline-primary mt-3"},{default:T(()=>e[32]||(e[32]=[a("i",{class:"bi bi-arrow-left me-2"},null,-1),n("Voltar à Homepage ")])),_:1})])]))])):p("",!0)])])])])])])])}}},la=B(aa,[["__scopeId","data-v-cf15b995"]]);export{la as default};
