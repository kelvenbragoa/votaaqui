import{_ as U,r as c,o as B,c as o,b as a,d as T,w as D,t as p,g as F,h as r,m,e as j,i as _,n as w,p as $,j as V,k as z,l,u as A,q as J}from"./app-Bf6Mdg56.js";const H={id:"app"},L={class:"main"},G={class:"page-title dark-background",style:{"background-image":"url('/votaaqui/assets/img/events/showcase-9.webp')"}},K={class:"container position-relative"},Q={class:"breadcrumbs"},W={id:"vote-form",class:"buy-tickets section"},X={class:"container"},Y={class:"row justify-content-center"},Z={class:"col-lg-8"},ee={class:"ticket-form-wrapper"},ae={key:0,class:"text-center my-5"},te={key:1,class:"alert alert-danger",role:"alert"},se={key:2},oe={class:"ticket-types"},le={class:"ticket-option selected"},ie={class:"participant-card"},ne={class:"participant-image"},re=["src","alt"],de={class:"participant-info"},ue={class:"participant-bio"},ve={class:"participant-details"},ce={key:0},pe={key:1},me={key:2},ge={class:"row"},be={class:"col-md-6"},_e={class:"form-group"},fe=["disabled"],he={class:"col-md-6"},ye={class:"form-group"},ke=["disabled"],we={class:"col-md-6"},xe={class:"form-group"},Pe=["disabled"],Ve={class:"col-md-6"},Ne={class:"form-group"},Ee=["disabled"],Se={class:"terms-checkbox"},Te=["disabled"],De={class:"newsletter-checkbox"},$e=["disabled"],qe={key:0,class:"loading"},Re={key:1,class:"loading"},Ce={key:2,class:"loading"},Ie={key:3,class:"error-message"},Me={key:4,class:"error-message"},Oe={key:5,class:"sent-message"},Ue={class:"form-submit"},Be=["disabled"],Fe={key:0,class:"bi bi-credit-card me-2"},je={key:1,class:"bi bi-check-circle me-2"},ze={key:2,class:"bi bi-cash me-2"},Ae={key:3},Je={key:4},He={key:5},Le={key:6},Ge={key:0,class:"mt-2 text-warning small"},Ke={__name:"VotePage",setup(Qe){const q=A(),R=J(),x=c(!1),f=c(null),s=c(null),n=c(!1),u=c(null),h=c(!1),g=c(!1),y=c(!1),P=c(!1);c(null);const t=c({firstName:"",lastName:"",email:"",phone:"",acceptTerms:!1,newsletter:!1}),C=async()=>{var v,e;try{x.value=!0,f.value=null;const d=q.params.id;if(!d)throw new Error("ID do participante não fornecido");console.log("Fetching participant with ID:",d);const i=await V.get(`/api/votaaqui/participants/${d}`);s.value=i.data.data,console.log("Participant loaded:",s.value)}catch(d){console.error("Error fetching participant:",d),f.value=((e=(v=d.response)==null?void 0:v.data)==null?void 0:e.message)||d.message||"Erro ao carregar participante"}finally{x.value=!1}},I=async()=>{var v,e,d,i,N;try{if(n.value=!0,u.value=null,h.value=!1,P.value=null,console.log("Participant data:",s.value),console.log("Participant ID:",(v=s.value)==null?void 0:v.id),!s.value||!s.value.id){u.value="Erro: Dados do participante não encontrados. Recarregue a página.",n.value=!1;return}if(!t.value.phone||t.value.phone.trim()===""){u.value="Número de telefone é obrigatório para o pagamento.",n.value=!1;return}if(!/^[8-9][0-9]{8}$/.test(t.value.phone)){u.value="Número de telefone inválido. Digite 9 dígitos começando com 8 ou 9.",n.value=!1;return}g.value=!0,u.value="Processando pagamento de 50 MT...";const E={amount:50,phone:`+258${t.value.phone}`,description:`Voto para ${s.value.stage_name||s.value.name}`,reference:`VOTE_${s.value.id}_${Date.now()}`};console.log("Processing payment:",E);const k=await V.post("/api/votaaqui/payments/process",E);if(!k.data.success)throw new Error(k.data.message||"Falha no pagamento");y.value=!0,g.value=!1,u.value="Pagamento aprovado! Registrando voto...";const S={participant_id:s.value.id,voter_name:`${t.value.firstName} ${t.value.lastName}`,voter_email:t.value.email||null,voter_phone:`+258${t.value.phone}`,newsletter_subscription:t.value.newsletter,payment_reference:k.data.reference,payment_amount:50,payment_phone:`+258${t.value.phone}`};console.log("Registering vote with payment:",S);const We=await V.post("/api/votaaqui/votes",S);h.value=!0,localStorage.setItem("votedParticipant",JSON.stringify(s.value)),localStorage.setItem("voteData",JSON.stringify({voter_name:`${t.value.firstName} ${t.value.lastName}`,voter_email:t.value.email,voter_phone:`+258${t.value.phone}`,payment_amount:50,payment_reference:k.data.reference,voted_at:new Date().toISOString()})),setTimeout(()=>{R.push("/voto-sucesso")},1e3)}catch(b){console.error("Vote submission error:",b),g.value?(P.value=!0,g.value=!1,u.value=((d=(e=b.response)==null?void 0:e.data)==null?void 0:d.message)||b.message||"Erro no pagamento. Tente novamente."):u.value=((N=(i=b.response)==null?void 0:i.data)==null?void 0:N.message)||b.message||"Ocorreu um erro ao registrar o voto. Tente novamente.",h.value=!1}finally{n.value=!1}},M=v=>{v.target.src="/votaaqui/assets/img/events/speaker-4.webp"},O=v=>{let e=v.target.value;e=e.replace(/\D/g,""),e.length>9&&(e=e.substring(0,9)),t.value.phone=e,v.target.value=e};return B(()=>{C()}),(v,e)=>{const d=z("router-link");return l(),o("div",H,[a("main",L,[a("div",G,[a("div",K,[e[8]||(e[8]=a("h1",null,"Vote no seu participante",-1)),e[9]||(e[9]=a("p",null,"Complete os dados para confirmar o seu voto.",-1)),a("nav",Q,[a("ol",null,[a("li",null,[T(d,{to:"/"},{default:D(()=>e[6]||(e[6]=[r("Home")])),_:1})]),e[7]||(e[7]=a("li",{class:"current"},"Seu voto",-1))])])])]),a("section",W,[a("div",X,[a("div",Y,[a("div",Z,[a("div",ee,[x.value?(l(),o("div",ae,e[10]||(e[10]=[a("div",{class:"spinner-border",role:"status"},[a("span",{class:"visually-hidden"},"Carregando...")],-1),a("p",{class:"mt-3"},"Carregando informações do participante...",-1)]))):f.value?(l(),o("div",te,[e[12]||(e[12]=a("h5",null,"Erro ao carregar participante",-1)),a("p",null,p(f.value),1),T(d,{to:"/",class:"btn btn-outline-danger"},{default:D(()=>e[11]||(e[11]=[a("i",{class:"bi bi-arrow-left me-1"},null,-1),r(" Voltar à página inicial ")])),_:1})])):s.value?(l(),o("div",se,[e[31]||(e[31]=F('<div class="event-info mb-5" data-v-7757d44d><h3 data-v-7757d44d>Reality Show - Estrelas do LIV</h3><div class="event-details" data-v-7757d44d><div class="event-meta" data-v-7757d44d><span data-v-7757d44d><i class="bi bi-calendar-event" data-v-7757d44d></i> Setembro 2025</span><span data-v-7757d44d><i class="bi bi-geo-alt" data-v-7757d44d></i> Moçambique</span><span data-v-7757d44d><i class="bi bi-clock" data-v-7757d44d></i> Votação 24h</span></div></div></div>',1)),a("div",oe,[e[16]||(e[16]=a("h4",null,"Participante selecionado",-1)),a("div",le,[a("div",ie,[a("div",ne,[a("img",{src:s.value.photo_url||"/votaaqui/assets/img/events/speaker-4.webp",alt:s.value.name,class:"img-fluid",onError:M},null,40,re)]),a("div",de,[a("h5",null,p(s.value.stage_name||s.value.name),1),a("p",ue,p(s.value.biography||"Participante do Reality Show"),1),a("div",ve,[s.value.age?(l(),o("span",ce,[e[13]||(e[13]=a("i",{class:"bi bi-person"},null,-1)),r(" "+p(s.value.age)+" anos ",1)])):m("",!0),s.value.city?(l(),o("span",pe,[e[14]||(e[14]=a("i",{class:"bi bi-geo-alt"},null,-1)),r(" "+p(s.value.city),1)])):m("",!0),s.value.skills?(l(),o("span",me,[e[15]||(e[15]=a("i",{class:"bi bi-star"},null,-1)),r(" "+p(s.value.skills),1)])):m("",!0)])])])])]),a("form",{onSubmit:j(I,["prevent"]),class:"php-email-form ticket-form"},[a("div",ge,[a("div",be,[a("div",_e,[e[17]||(e[17]=a("label",{for:"first_name"},"Nome *",-1)),_(a("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=i=>t.value.firstName=i),id:"first_name",class:"form-control",placeholder:"Seu primeiro nome",required:"",disabled:n.value},null,8,fe),[[w,t.value.firstName]])])]),a("div",he,[a("div",ye,[e[18]||(e[18]=a("label",{for:"last_name"},"Apelido *",-1)),_(a("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>t.value.lastName=i),id:"last_name",class:"form-control",placeholder:"Seu apelido",required:"",disabled:n.value},null,8,ke),[[w,t.value.lastName]])])]),a("div",we,[a("div",xe,[e[19]||(e[19]=a("label",{for:"email"},"Email",-1)),_(a("input",{type:"email","onUpdate:modelValue":e[2]||(e[2]=i=>t.value.email=i),id:"email",class:"form-control",placeholder:"seu@email.com",disabled:n.value},null,8,Pe),[[w,t.value.email]])])]),a("div",Ve,[a("div",Ne,[e[20]||(e[20]=a("label",{for:"phone"},"Contacto (Número de Carteira Móvel) *",-1)),_(a("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=i=>t.value.phone=i),id:"phone",class:"form-control",placeholder:"841234567",required:"",disabled:n.value,onInput:O,pattern:"[0-9]{9}",minlength:"9",maxlength:"9"},null,40,Ee),[[w,t.value.phone]]),e[21]||(e[21]=a("small",{class:"form-text text-muted"}," Digite apenas números (9 dígitos). Ex: 841234567 ",-1))])])]),e[30]||(e[30]=a("div",{class:"payment-info"},[a("div",{class:"tax-note"},"*Voto com pagamento de 50 MT via carteira móvel"),a("small",{class:"text-muted"},"O seu voto será contabilizado apenas após confirmação do pagamento.")],-1)),a("div",Se,[_(a("input",{type:"checkbox",id:"terms","onUpdate:modelValue":e[4]||(e[4]=i=>t.value.acceptTerms=i),required:"",disabled:n.value},null,8,Te),[[$,t.value.acceptTerms]]),e[22]||(e[22]=a("label",{for:"terms"},[r(" Concordo com os "),a("a",{href:"#",target:"_blank"},"Termos e Condições"),r(" e "),a("a",{href:"#",target:"_blank"},"Política de Privacidade"),r(" * ")],-1))]),a("div",De,[_(a("input",{type:"checkbox",id:"newsletter","onUpdate:modelValue":e[5]||(e[5]=i=>t.value.newsletter=i),disabled:n.value},null,8,$e),[[$,t.value.newsletter]]),e[23]||(e[23]=a("label",{for:"newsletter"}," Subscrever newsletter para atualizações do evento ",-1))]),g.value?(l(),o("div",qe,e[24]||(e[24]=[a("i",{class:"bi bi-credit-card me-2"},null,-1),r(" Processando pagamento de 50 MT... ")]))):y.value&&n.value?(l(),o("div",Re,e[25]||(e[25]=[a("i",{class:"bi bi-check-circle me-2"},null,-1),r(" Pagamento aprovado! Registrando voto... ")]))):n.value?(l(),o("div",Ce,e[26]||(e[26]=[a("i",{class:"bi bi-arrow-clockwise me-2"},null,-1),r(" Enviando voto... ")]))):m("",!0),P.value?(l(),o("div",Ie,[e[27]||(e[27]=a("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),r(" "+p(u.value),1)])):u.value?(l(),o("div",Me,[e[28]||(e[28]=a("i",{class:"bi bi-exclamation-circle me-2"},null,-1)),r(" "+p(u.value),1)])):m("",!0),h.value?(l(),o("div",Oe,e[29]||(e[29]=[a("i",{class:"bi bi-check-circle-fill me-2"},null,-1),r(" Pagamento e voto confirmados! Redirecionando... ")]))):m("",!0),a("div",Ue,[a("button",{type:"submit",class:"btn-submit",disabled:n.value||!t.value.acceptTerms||!s.value||!s.value.id||!t.value.phone.trim()},[g.value?(l(),o("i",Fe)):y.value?(l(),o("i",je)):(l(),o("i",ze)),g.value?(l(),o("span",Ae,"Processando Pagamento...")):y.value?(l(),o("span",Je,"Registrando Voto...")):n.value?(l(),o("span",He,"Enviando...")):(l(),o("span",Le,"Pagar 50 MT e Votar"))],8,Be),!s.value||!s.value.id?(l(),o("div",Ge," ⚠️ Aguardando carregamento dos dados do participante... ")):m("",!0)])],32)])):m("",!0)])])])])])])])}}},Ye=U(Ke,[["__scopeId","data-v-7757d44d"]]);export{Ye as default};
